(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{191:function(e,t,r){"use strict";var n=r(196).default;(n=r(200)).autoDiscover=!1,r(201);var o={name:"Dropzone",props:{multiple:{type:Boolean,default:!1},accept:{type:String,default:null},message:{type:String,default:"Drop file here or click to upload"}},data:function(){return{}},mounted:function(){var e=this;this.dropzone=new n(this.$el,{autoProcessQueue:!1,url:"#",acceptedFiles:this.accept,uploadMultiple:this.multiple,dictDefaultMessage:this.message,addedfile:function(t){e.$emit("drop",t)},thumbnail:function(t){e.$emit("thumbnail",t)}})},beforeDestroy:function(){this.dropzone&&this.dropzone.destroy()}},l=r(17),component=Object(l.a)(o,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"dropzone dropzone-component"})},[],!1,null,null,null);t.a=component.exports},196:function(e,t,r){"use strict";r.r(t);var n={name:"Loading"},o=r(17),component=Object(o.a)(n,function(){var e=this.$createElement;return(this._self._c||e)("div",[this._v("\n  Loading...\n")])},[],!1,null,null,null);t.default=component.exports},199:function(e,t,r){var content=r(380);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(54).default)("3c88e7bd",content,!0,{sourceMap:!1})},371:function(e,t,r){"use strict";r(38);var n=r(7),o=(r(212),r(2)),l=r(3),c=r.n(l),d=r(186),m=r.n(d),h=(r(384),r(0).default.component("jsoneditor-loading",{data:function(){return{}},template:"<div>Loading...</div>"}));h=r(388);var v={name:"DocEditor",props:{data:{type:Object,default:function(){return{}}},ro:{type:Boolean,default:!0}},data:function(){return{editor:null}},mounted:function(){var e=this;this.editor=new h(this.$el,{onChange:function(){e.editor&&e.$emit("change",e.editor.get())},onEditable:function(){return!e.ro}}),this.editor.set(this.data)},beforeDestroy:function(){this.editor&&(this.editor.destroy(),this.editor=null)}},f=r(17),y={name:"Doc",components:{docEditor:Object(f.a)(v,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"jsoneditor",staticStyle:{height:"200px"}})},[],!1,null,"19275aac",null).exports},props:{doc:{type:Object,required:!0},organization:{type:Object,required:!1,default:null}},data:function(){return{user:null,newValue:null,saving:!1,savingError:"",deleting:!1,deletingError:"",deleted:!1}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{doc:function(){this.loadUser()}},methods:{loadUser:function(){var e=this,t=this.$app_config.traildock_api_base_url+"rest/v2/user/"+this.doc.userId;c.a.get(t).then(function(t){e.user=t.data}).catch(function(){e.user=null})},onChangeValue:function(e){this.newValue=e},onDelete:function(){var e=this;if(confirm("Really delete this doc?")){this.deleting=!0,this.deletingError="";var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key;this.organization&&this.organization.id&&(t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key+"/organization/"+this.organization.id),c.a.delete(t,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(t){e.deleting=!1,e.deleted=!0}).catch(function(t){e.deleting=!1,o.has(t,"response.data.error")?e.deletingError=t.response.data.error:e.deletingError=t.message})}},onSave:function(){var e=this;this.saving=!0,this.savingError="";var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key;this.organization&&this.organization.id&&(t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key+"/organization/"+this.organization.id),c.a.put(t,this.newValue,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(t){e.saving=!1,e.newValue=null,e.$emit("save",t.data)}).catch(function(t){e.saving=!1,o.has(t,"response.data.error")?e.savingError=t.response.data.error:e.savingError=t.message})},formatDate:function(text){return m()(text).format("dddd, MMMM Do YYYY, h:mm:ss a")},mounted:function(){this.loadUser()}}},w={name:"OrganizationElementDocs",components:{doc:Object(f.a)(y,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:!e.deleted,expression:"!deleted"}]},[r("span",{staticClass:"tag is-dark"},[e._v(e._s(e.doc.key))]),e._v(" "),r("small",[e.doc.updatedAt?r("span",[e._v("saved "+e._s(e.formatDate(e.doc.updatedAt)))]):e._e(),e._v(" "),e.user?r("span",[e._v("by "+e._s(e.user.displayName))]):e._e(),e._v(" "),r("doc-editor",{attrs:{ro:!e.authenticated,data:e.doc.value},on:{change:e.onChangeValue}})],1),e._v(" "),e.authenticated?r("div",{staticClass:"field has-addons"},[r("p",{staticClass:"control"},[r("button",{staticClass:"button is-primary",attrs:{disabled:(e.saving||!e.newValue)&&e.doc.id},on:{click:e.onSave}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.saving,expression:"!saving"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-save"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.saving,expression:"saving"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Save")])])]),e._v(" "),r("p",{staticClass:"control"},[r("button",{staticClass:"button is-danger",attrs:{disabled:e.deleting||!e.doc.id},on:{click:e.onDelete}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.deleting,expression:"!deleting"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-trash"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.deleting,expression:"deleting"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Delete")])])])]):e._e(),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.savingError,expression:"savingError"}],staticClass:"notification is-danger"},[e._v("\n    "+e._s(e.savingError)+"\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.deletingError,expression:"deletingError"}],staticClass:"notification is-danger"},[e._v("\n    "+e._s(e.deletingError)+"\n  ")])])},[],!1,null,"357a5e8e",null).exports},props:{organization:{type:Object,required:!0},elementId:{type:String,required:!0},elementType:{type:String,required:!0}},data:function(){return{docs:[],loadingDocsError:"",loadingDocs:!1,showNewDocModal:!1,newDocKey:"",newDocError:""}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{elementId:function(){this.loadDocs()}},mounted:function(){this.loadDocs()},methods:{loadDocs:function(){var e=this;this.loadingDocs=!0,this.loadingDocsError="",this.docs=[];var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.elementType+"/"+this.elementId;this.organization.id&&(t=t+"/organization/"+this.organization.id),c.a.get(t).then(function(t){e.docs=t.data,e.loadingDocs=!1}).catch(function(t){var r="";r=o.has(t,"response.data.error")?t.response.data.error:t.message,e.docs=[],e.loadingDocsError=r,e.loadingDocs=!1})},onDocSave:function(e,t){e.value=t.value,e.updatedAt=t.updatedAt,e.createdAt=t.createdAt,e.userId=t.userId,e.key=t.key,e.images=t.images,e.organizationId=t.organizationId,e.id=t.id,e.isNew=!1},onCreateNewDoc:function(){this.newDocError="";var e={};e[this.newDocKey]="",this.docs.push({docableId:this.elementId,docableType:this.elementType,key:this.newDocKey,value:e}),this.newDocKey="",this.showNewDocModal=!1}}},_=Object(f.a)(w,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("nav",{staticClass:"level"},[r("div",{staticClass:"level-left"},[e.organization.logoImageUrl?r("div",{staticClass:"level-item"},[r("figure",{staticClass:"image is-24x24"},[r("img",{attrs:{src:e.organization.logoImageUrl}})])]):e._e(),e._v(" "),r("div",{staticClass:"level-item"},[r("strong",{directives:[{name:"show",rawName:"v-show",value:e.organization.name,expression:"organization.name"}]},[e._v(e._s(e.organization.name))])])])]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.loadingDocs,expression:"loadingDocs"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-spinner-third fa-spin"})]),e._v(" "),e._l(e.docs,function(t){return r("doc",{key:t.id,staticStyle:{"margin-bottom":"10px"},attrs:{doc:t,organization:e.organization},on:{save:function(r){return e.onDocSave(t,r)}}})}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.docs.length,expression:"docs.length === 0"}]},[e._v("\n    No docs found for this element.\n  ")]),e._v(" "),e.authenticated?r("div",{staticStyle:{"margin-top":"20px"}},[r("button",{staticClass:"button is-info",attrs:{disabled:!e.authenticated},on:{click:function(t){e.showNewDocModal=!0}}},[e._m(0),e._v(" "),r("span",[e._v("Add New Doc")])])]):e._e(),e._v(" "),r("div",{staticClass:"modal",class:{"is-active":e.showNewDocModal}},[r("div",{staticClass:"modal-background"}),e._v(" "),r("div",{staticClass:"modal-card"},[r("header",{staticClass:"modal-card-head"},[r("p",{staticClass:"modal-card-title"},[e._v("\n          Create New Doc\n        ")]),e._v(" "),r("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){e.showNewDocModal=!1}}})]),e._v(" "),r("section",{staticClass:"modal-card-body"},[r("div",{staticClass:"field"},[r("label",{staticClass:"label"},[e._v("Doc Key")]),e._v(" "),r("div",{staticClass:"control"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.newDocKey,expression:"newDocKey"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.newDocKey},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onCreateNewDoc(t)},input:function(t){t.target.composing||(e.newDocKey=t.target.value)}}})])])]),e._v(" "),r("footer",{staticClass:"modal-card-foot"},[r("button",{staticClass:"button is-success",on:{click:e.onCreateNewDoc}},[e._m(1),e._v(" "),r("span",[e._v("Create")])]),e._v(" "),r("button",{staticClass:"button is-primary",on:{click:function(t){e.showNewDocModal=!1}}},[e._v("\n          Cancel\n        ")])])])])],2)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa-fw fas fa-plus"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-plus"})])}],!1,null,"b97128cc",null).exports,j={name:"OSMElementImages",components:{dropzone:r(191).a},props:{elementId:{type:String,required:!0},elementType:{type:String,required:!0}},data:function(){return{loadingImages:!1,loadingImagesError:"",images:[],maxImageSize:5e6,removingImage:!1,removingImageError:"",addingImage:!1,addingImageError:""}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]},me:function(){return this.$store.state.user.me}},watch:{elementId:function(){this.loadImages()}},mounted:function(){this.loadImages()},methods:{loadImages:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingImages=!0,e.prev=1,e.next=4,c.a.get(this.$app_config.traildock_api_base_url+"rest/v2/images/"+this.elementType+"/"+this.elementId);case 4:t=e.sent,this.images=t.data,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),this.loadingImages=!1,o.has(e.t0,"response.data.error")?this.loadingImagesError=e.t0.response.data.error:this.loadingImagesError=e.t0.message;case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}(),addImage:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.size<=this.maxImageSize)){e.next=19;break}return this.addingImage=!0,this.addingImageError="",(r=new FormData).set("imageFile",t),e.prev=5,e.next=8,c.a.post(this.$app_config.traildock_api_base_url+"rest/v2/image/attach/"+this.elementType+"/"+this.elementId,r,{headers:{Authorization:"Bearer "+this.$store.state.user.token,"content-type":"multipart/form-data"}});case 8:n=e.sent,this.addingImage=!1,this.images.push(n.data),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),o.has(e.t0,"response.data.error")?this.addingImageError=e.t0.response.data.error:this.addingImageError=e.t0.message,this.addingImage=!1;case 17:e.next=20;break;case 19:alert("Image file too large!");case 20:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}(),removeImage:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(image){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("This image will be removed from the element.  Continue?")){e.next=13;break}return this.removingImage=!0,e.prev=2,e.next=5,c.a.delete(this.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+"/detach",{headers:{Authorization:"Bearer "+this.$store.state.user.token}});case 5:this.removingImage=!1,this.images=o.filter(this.images,function(img){return img.id!==image.id}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),o.has(e.t0,"response.data.error")?this.removingImageError=e.t0.response.data.error:this.removingImageError=e.t0.message,this.removingImage=!1;case 13:case"end":return e.stop()}},e,this,[[2,9]])}));return function(t){return e.apply(this,arguments)}}(),formattedDocDate:function(e){return m()(e).format("dddd, MMMM Do YYYY, h:mm a")},showImageInModal:function(image){this.$emit("image",image.url)}}},k={name:"OSMElement",components:{organization:_,images:Object(f.a)(j,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",{staticClass:"title is-5"},[e._v("\n    Images\n  ")]),e._v(" "),e._l(e.images,function(image){return r("article",{key:image.id,staticClass:"media"},[r("figure",{staticClass:"media-left"},[r("p",{staticClass:"image is-128x128"},[r("a",{on:{click:function(t){return t.preventDefault(),e.showImageInModal(image)}}},[r("img",{staticStyle:{width:"128px"},attrs:{src:image.url}})])])]),e._v(" "),r("div",{staticClass:"media-content"},[r("div",{staticClass:"content"},[r("p",[image.user?r("span",[e._v("by ")]):e._e(),image.user?r("strong",[e._v(e._s(image.user.displayName))]):e._e(),e._v(" "),r("small",[e._v(e._s(e.formattedDocDate(image.createdAt)))])])]),e._v(" "),r("nav",{staticClass:"level is-mobile"},[r("div",{staticClass:"level-left"},[r("a",{on:{click:function(t){return t.preventDefault(),e.showImageInModal(image)}}},[e._m(0,!0)])])])]),e._v(" "),r("div",{staticClass:"media-right"},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.authenticated&&e.me&&image.user&&e.me.id===image.user.id,expression:"authenticated && me && image.user && me.id === image.user.id"}],staticClass:"delete",on:{click:function(t){return e.removeImage(image)}}})])])}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.images.length,expression:"images.length === 0"}]},[e._v("\n    No images have been attached to this element.\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.authenticated,expression:"authenticated"}],staticClass:"field"},[r("div",{staticClass:"control"},[r("dropzone",{attrs:{multiple:!0,message:'<a href="javascript:;" class="upload-link">Drop file here or click to select an image</a>',accept:"image/*"},on:{thumbnail:e.addImage}})],1),e._v(" "),r("p",{staticClass:"help"},[e._v("\n      5Mb max filesize\n    ")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.removingImage,expression:"removingImage"}],staticClass:"notification is-primary"},[e._v("\n    Removing image from element "),e._m(1)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.addingImage,expression:"addingImage"}],staticClass:"notification is-primary"},[e._v("\n    Adding image to element "),e._m(2)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.addingImageError,expression:"addingImageError"}],staticClass:"notification is-danger"},[r("button",{staticClass:"delete",on:{click:function(t){e.addingImageError=""}}}),e._v("\n    "+e._s(e.addingImageError)+"\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.removingImageError,expression:"removingImageError"}],staticClass:"notification is-danger"},[r("button",{staticClass:"delete",on:{click:function(t){e.removingImageError=""}}}),e._v("\n    "+e._s(e.removingImageError)+"\n  ")])],2)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon is-small"},[t("i",{staticClass:"fas fa-expand"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-spinner-third fa-spin"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-spinner-third fa-spin"})])}],!1,null,"5ba5fb99",null).exports},props:{elementId:{type:String,required:!0}},data:function(){return{elementName:"",modalImageUrl:"",centerWait:!1,centerNodeId:"",osmTags:[],memberships:[]}},computed:{elementType:function(){if(this.elementId&&this.elementId.length>0)switch(this.elementId[0]){case"w":return"way";case"n":return"node";default:return"relation"}return""},elementRawId:function(){return o.trimStart(this.elementId,"wnr")}},watch:{elementId:function(){this.loadElementInfo()},"$store.state.user.me":function(){this.loadMemberships()}},mounted:function(){this.loadElementInfo(),this.loadMemberships()},methods:{sendCenterEvent:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r,n,o,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.centerWait=!0,e.prev=1,e.next=4,c.a.get("https://api.openstreetmap.org/api/0.6/node/"+this.centerNodeId);case 4:t=e.sent,r=new DOMParser,n=r.parseFromString(t.data,"text/xml"),(o=n.getElementsByTagName("node"))&&o.length>0&&(l=o[0].getAttribute("lat"),d=o[0].getAttribute("lon"),l&&d&&this.$emit("center",{lat:l,lng:d})),this.centerWait=!1,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.centerWait=!1;case 15:case"end":return e.stop()}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}(),loadElementInfo:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r,n,o,i,l,d,m,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.elementType){e.next=11;break}return e.next=3,c.a.get("https://api.openstreetmap.org/api/0.6/"+this.elementType+"/"+this.elementRawId);case 3:for(t=e.sent,this.elementName="",r=new DOMParser,n=r.parseFromString(t.data,"text/xml"),o=n.getElementsByTagName("tag"),i=0;i<o.length;i++)"name"===(l=o[i]).getAttribute("k")&&(d=l.getAttribute("v"))&&(this.elementName=d),this.osmTags.push({key:l.getAttribute("k"),value:l.getAttribute("v")});(m=n.getElementsByTagName("nd"))&&m.length>0&&(h=m[0].getAttribute("ref"))&&(this.centerNodeId=h);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),loadMemberships:function(){var e=this;this.memberships=[],this.$store.state.user.me&&this.$store.dispatch("user/goFetchMemberships",{}).then(function(t){e.memberships=t})},showImageModal:function(e){e&&(this.modalImageUrl=e)}}},x=Object(f.a)(k,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.elementType,expression:"elementType"}]},[r("div",{},[r("div",{},[r("h1",{staticClass:"title is-3"},[e._v("\n        "+e._s(e.elementName)+"\n      ")]),e._v(" "),r("h2",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.elementType)+" "+e._s(e.elementRawId)+"\n      ")])]),e._v(" "),r("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.centerNodeId,expression:"centerNodeId"}],staticClass:"button is-small",on:{click:e.sendCenterEvent}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.centerWait,expression:"!centerWait"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-fw fa-location"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.centerWait,expression:"centerWait"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-fw fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Center In Map")])])])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.osmTags.length>0&&!e.$store.state.ideditor.isEmbedded,expression:"osmTags.length > 0 && !$store.state.ideditor.isEmbedded"}],staticClass:"field is-grouped is-grouped-multiline"},e._l(e.osmTags,function(t){return r("div",{key:t.key,staticClass:"control"},[r("div",{staticClass:"tag",class:{"is-success":"yes"===t.value||"designated"===t.value,"is-danger":"no"===t.value}},[e._v("\n        "+e._s(t.key)+" : "+e._s(t.value)+"\n      ")])])}),0),e._v(" "),r("organization",{staticStyle:{"margin-bottom":"20px"},attrs:{organization:{name:"",id:null},"element-type":e.elementType,"element-id":e.elementRawId}}),e._v(" "),e._l(e.memberships,function(t){return r("div",{key:t.id,staticClass:"box"},[r("organization",{attrs:{organization:t,"element-type":e.elementType,"element-id":e.elementRawId}})],1)}),e._v(" "),r("images",{attrs:{"element-type":e.elementType,"element-id":e.elementRawId},on:{image:e.showImageModal}}),e._v(" "),r("hr"),e._v(" "),r("div",{staticClass:"modal",class:{"is-active":e.modalImageUrl}},[r("div",{staticClass:"modal-background"}),e._v(" "),r("div",{staticClass:"modal-content"},[r("p",{staticClass:"image is-4by3"},[r("img",{attrs:{src:e.modalImageUrl,alt:""}})])]),e._v(" "),r("button",{staticClass:"modal-close is-large is-primary",attrs:{"aria-label":"close"},on:{click:function(t){e.modalImageUrl=null}}})])],2)},[],!1,null,"3dab304a",null);t.a=x.exports},372:function(e,t,r){"use strict";r(39),r(38);var n=r(7),o=(r(212),r(110),r(57),r(377),r(211),r(55),r(56),r(20),r(2)),l=r(378),c=r.n(l),d={name:"TraildockMap",props:{startLocation:{type:Object,required:null,default:function(){return{}}},showObservationMarker:{type:Object,required:null,default:function(){return{}}},rememberLocation:{type:Boolean,default:!0},rememberLocationKey:{type:String,default:"traildock_map"},observations:{type:Array,default:function(){return[]}}},data:function(){return{map:null,mapLat:0,mapLng:0,mapZoom:0,selectedLayers:[],highlightLayerAdded:!1,observationMarker:null,observationMarkers:[],startingMapLat:localStorage.getItem(this.rememberLocationKey+":mapLat")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapLat")||"38.870010"):38.87001,startingMapLng:localStorage.getItem(this.rememberLocationKey+":mapLng")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapLng")||"-106.980974"):-106.980974,startingMapZoom:localStorage.getItem(this.rememberLocationKey+":mapZoom")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapZoom")||"12"):12}},computed:{me:function(){return this.$store.state.user.me}},watch:{mapLat:function(){this.mapLat&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapLat",this.mapLat+"")},mapLng:function(){this.mapLng&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapLng",this.mapLng+"")},mapZoom:function(){this.mapZoom&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapZoom",this.mapZoom+"")},showObservationMarker:function(){if(this.map)if(o.isEmpty(this.showObservationMarker))this.observationMarker&&this.observationMarker.remove();else{if(!this.observationMarker){var e=c.a.parseHTML('<div class="observationMarker new" style="text-align: center;"><i style="font-size: 36px; color: #FF0000;" class="far fa-map-marker-alt"></i></div>');this.observationMarker=new mapboxgl.Marker(e[0]).setOffset([0,-18]).setLngLat(new mapboxgl.LngLat(this.showObservationMarker.lng,this.showObservationMarker.lat))}this.observationMarker.setLngLat(new mapboxgl.LngLat(this.showObservationMarker.lng,this.showObservationMarker.lat)),this.observationMarker.addTo(this.map)}},observations:function(){var e=this,t=[],r=[],n=[],l=!0,c=!1,d=void 0;try{for(var m,h=function(){var r=m.value;o.find(e.observationMarkers,function(e){return e._observation.properties.id===r.properties.id})||t.push(r),r._forceMapUpdate&&(n.push(r.properties.id),t.push(r))},v=this.observations[Symbol.iterator]();!(l=(m=v.next()).done);l=!0)h()}catch(e){c=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw d}}var f=!0,y=!1,w=void 0;try{for(var _,j=function(){var marker=_.value,t=marker;o.find(e.observations,function(e){return e.properties.id===t._observation.properties.id})||r.push(marker),o.indexOf(n,t._observation.properties.id)>=0&&r.push(marker)},k=this.observationMarkers[Symbol.iterator]();!(f=(_=k.next()).done);f=!0)j()}catch(e){y=!0,w=e}finally{try{f||null==k.return||k.return()}finally{if(y)throw w}}for(var x=0,I=r;x<I.length;x++){I[x].remove()}for(var C=0,L=t;C<L.length;C++){var z=L[C];this.addObservation(z)}n&&this.$emit("marker-forced",n)}},mounted:function(){this.loadMap()},beforeDestroy:function(){this.map&&this.map.remove()},methods:{highlightSelectedLayers:function(){if(this.map.isStyleLoaded()&&!this.highlightLayerAdded&&(this.highlightLayerAdded=!0,this.map.addSource("highlight",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"highlight",type:"line",source:"highlight",paint:{"line-color":"yellow","line-opacity":.75,"line-width":8}})),this.highlightLayerAdded){var source=this.map.getSource("highlight");source&&source.setData({type:"FeatureCollection",features:[]});var e=[],t=!0,r=!1,n=void 0;try{for(var o,l=this.selectedLayers[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var c=o.value,d=this.map.querySourceFeatures(c.source,{sourceLayer:c.sourceLayer,filter:[c.filterOp,c.filterField,c.filterCompare]}),m=!0,h=!1,v=void 0;try{for(var f,y=d[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var w=f.value;e.push(w.toJSON())}}catch(e){h=!0,v=e}finally{try{m||null==y.return||y.return()}finally{if(h)throw v}}}}catch(e){r=!0,n=e}finally{try{t||null==l.return||l.return()}finally{if(r)throw n}}if(this.highlightLayerAdded&&e)if(e.length>1){var _={type:"FeatureCollection",features:e};source.setData(_)}else 1===e.length&&source.setData(e[0])}},loadMap:function(){var e=this,t=this.startingMapLat,r=this.startingMapLng,n=this.startingMapZoom;this.startLocation&&(o.has(this.startLocation,"lat")&&(t=this.startLocation.lat),o.has(this.startLocation,"lng")&&(r=this.startLocation.lng),o.has(this.startLocation,"zoom")&&(n=this.startLocation.zoom)),o.set(mapboxgl,"accessToken",this.$app_config.mapbox_access_token),this.map=new mapboxgl.Map({container:this.$el,style:this.$app_config.mapbox_base_style,center:new mapboxgl.LngLat(r,t),zoom:n,logoPosition:"top-left"}),this.map&&(this.map.addControl(new mapboxgl.NavigationControl),this.map.on("load",function(){setTimeout(function(){e.highlightRouteIds()},500),e.map.on("moveend",function(t){var r=e.map.getBounds().getCenter();e.mapLat=r.lat,e.mapLng=r.lng,e.highlightSelectedLayers(),e.$emit("newbounds")}),e.map.on("zoomend",function(t){e.mapZoom=e.map.getZoom(),e.highlightSelectedLayers(),e.$emit("newbounds")}),e.$emit("newbounds")}),this.map.on("mousemove",function(t){var r=e.map.queryRenderedFeatures(t.point),n=!1,o=!0,l=!1,c=void 0;try{for(var d,m=r[Symbol.iterator]();!(o=(d=m.next()).done);o=!0){var h=d.value;"traildock-trails"===h.layer.source?n=!0:h.id&&(h.id+"").length>1&&(n=!0)}}catch(e){l=!0,c=e}finally{try{o||null==m.return||m.return()}finally{if(l)throw c}}e.map.getCanvas().style.cursor=n?"pointer":""}),this.map.on("click",function(t){if(o.isEmpty(e.showObservationMarker)){e.selectedLayers=[];var r=[[t.point.x-5,t.point.y-5],[t.point.x+5,t.point.y+5]],n=e.map.queryRenderedFeatures(r),l=[],c=!0,d=!1,m=void 0;try{for(var h,v=n[Symbol.iterator]();!(c=(h=v.next()).done);c=!0){var f=h.value,y=null;if("traildock-trails"===f.layer.source){if(f.properties&&(y="w"+f.properties.id)&&o.indexOf(l,y)<0){l.push(y);var w=f;e.selectedLayers.push({source:w.source,sourceLayer:w.sourceLayer,filterOp:"==",filterField:"id",filterCompare:f.properties.id})}}else if(f.id&&(f.id+"").length>2&&(o.endsWith(f.id+"","0")&&(y="n"+Math.floor(+f.id/10)),o.endsWith(f.id+"","1")&&(y="w"+Math.floor(+f.id/10)),o.endsWith(f.id+"","4")&&(y="r"+Math.floor(+f.id/10)),y&&o.indexOf(l,y)<0)){l.push(y);var _=f;e.selectedLayers.push({source:_.source,sourceLayer:_.sourceLayer,filterOp:"==",filterField:"$id",filterCompare:f.id})}}}catch(e){d=!0,m=e}finally{try{c||null==v.return||v.return()}finally{if(d)throw m}}l=o.compact(o.uniq(l)),e.$store.commit("ideditor/setSelectedIds",{selectedIds:l}),e.highlightSelectedLayers()}else{var j=t.lngLat.lat,k=t.lngLat.lng;e.$emit("observation-marker-move",{lat:j,lng:k})}}))},highlightRouteIds:function(){if(this.$route.query.ids){var e=this.$route.query.ids.split(","),t=!0,r=!1,n=void 0;try{for(var l,c=e[Symbol.iterator]();!(t=(l=c.next()).done);t=!0){var d=l.value;o.startsWith(d,"w")&&(this.selectedLayers.push({source:"composite",sourceLayer:"road",filterOp:"==",filterField:"$id",filterCompare:parseInt(o.trimStart(d,"w")+"1")}),this.selectedLayers.push({source:"traildock-trails",sourceLayer:"layer",filterOp:"==",filterField:"osm_id",filterCompare:"way:"+o.trimStart(d,"w")}))}}catch(e){r=!0,n=e}finally{try{t||null==c.return||c.return()}finally{if(r)throw n}}this.highlightSelectedLayers()}},center:function(e){this.map&&this.map.panTo(new mapboxgl.LngLat(e.lng,e.lat))},getCenter:function(){if(this.map)return this.map.getBounds().getCenter()},getZoom:function(){if(this.map)return this.map.getZoom()},bounds:function(){return this.map?this.map.getBounds():null},resize:function(e){this.map&&this.map.resize()},getOrganization:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,this.$store.dispatch("organization/goFetch",{id:t});case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),addObservation:function(e){var t=this;this.getOrganization(e.properties.organizationId).then(function(r){var n=null,l="";if(o.indexOf(e.properties.tags,"type:report")>-1){l="report";n=c.a.parseHTML('<div class="observationMarker report" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #0000FF;" class="fas fa-exclamation-circle"></i></div>')}else if(o.indexOf(e.properties.tags,"type:trailhead")>-1){l="trailhead";n=c.a.parseHTML('<div class="observationMarker trailhead" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #8B4513;" class="fas fa-sign"></i></div>')}else if(o.indexOf(e.properties.tags,"type:sign")>-1){l="sign";n=c.a.parseHTML('<div class="observationMarker sign" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #25912c;" class="fas fa-map-signs"></i></div>')}else{n=c.a.parseHTML('<div class="observationMarker" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #ffff00;" class="fas fa-sticky-note"></i></div>')}if(n){var marker=new mapboxgl.Marker(n[0]).setLngLat(e.geometry.coordinates),d='<div style="max-width: 200px;">';if(r&&r.logoImageUrl&&(d+='<img style="height: 36px;" src="'.concat(r.logoImageUrl,'">')),o.has(e,"properties.name")&&e.properties.name?d=d+"<div><strong>"+o.escape(e.properties.name)+"</strong></div>":d+="<div><strong>Observation</strong></div>",o.has(e,"properties.description")&&(d=d+"<div>"+o.escape(e.properties.description)+"</div>"),"trailhead"===l&&(d=d+'<div><a href="https://www.google.com/maps/dir/?api=1&destination='+e.geometry.coordinates[1]+","+e.geometry.coordinates[0]+'" target="_blank">Driving Directions</a></div>'),o.has(e,"properties.tags")&&e.properties.tags){d+='<div style="margin-bottom: 5px;">';var m=!0,h=!1,v=void 0;try{for(var f,y=e.properties.tags[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var w=f.value;w&&(d=d+'<span class="tag">'+w+"</span>")}}catch(e){h=!0,v=e}finally{try{m||null==y.return||y.return()}finally{if(h)throw v}}d+="</div>"}if(o.has(e,"properties.images")&&e.properties.images){var _=!0,j=!1,k=void 0;try{for(var x,I=e.properties.images[Symbol.iterator]();!(_=(x=I.next()).done);_=!0){var image=x.value;d=d+'<div><img style="cursor: pointer;" style="width: 128px;" data-uri="'+image.url+'" src="'+t.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+'/resize?width=128&height=128"/></div>'}}catch(e){j=!0,k=e}finally{try{_||null==I.return||I.return()}finally{if(j)throw k}}}t.me&&(t.me.id===e.properties.user.id||t.me.isSuperuser)&&(d+='<div><button class="button is-small is-primary edit">Edit</button><button class="button is-small is-danger destroy">Delete</button></div>'),d+="</div>";var C=c()(c.a.parseHTML(d));C.find("img").on("click",function(e){t.$emit("show-observation-image",c()(e.target).attr("data-uri"))}),C.find("button.destroy").on("click",function(r){t.$emit("delete-observation",e)}),C.find("button.edit").on("click",function(r){t.$emit("edit-observation",e)});var L=(new mapboxgl.Popup).setDOMContent(C[0]);marker.setPopup(L),marker._observation=e,t.observationMarkers.push(marker),marker.addTo(t.map)}})}}},m=(r(379),r(17)),component=Object(m.a)(d,function(){var e=this.$createElement;return(this._self._c||e)("div")},[],!1,null,null,null);t.a=component.exports},379:function(e,t,r){"use strict";var n=r(199);r.n(n).a},380:function(e,t,r){(e.exports=r(53)(!1)).push([e.i,".observationMarker{cursor:pointer}",""])},381:function(e,t,r){var map={"./af":215,"./af.js":215,"./ar":216,"./ar-dz":217,"./ar-dz.js":217,"./ar-kw":218,"./ar-kw.js":218,"./ar-ly":219,"./ar-ly.js":219,"./ar-ma":220,"./ar-ma.js":220,"./ar-sa":221,"./ar-sa.js":221,"./ar-tn":222,"./ar-tn.js":222,"./ar.js":216,"./az":223,"./az.js":223,"./be":224,"./be.js":224,"./bg":225,"./bg.js":225,"./bm":226,"./bm.js":226,"./bn":227,"./bn.js":227,"./bo":228,"./bo.js":228,"./br":229,"./br.js":229,"./bs":230,"./bs.js":230,"./ca":231,"./ca.js":231,"./cs":232,"./cs.js":232,"./cv":233,"./cv.js":233,"./cy":234,"./cy.js":234,"./da":235,"./da.js":235,"./de":236,"./de-at":237,"./de-at.js":237,"./de-ch":238,"./de-ch.js":238,"./de.js":236,"./dv":239,"./dv.js":239,"./el":240,"./el.js":240,"./en-SG":241,"./en-SG.js":241,"./en-au":242,"./en-au.js":242,"./en-ca":243,"./en-ca.js":243,"./en-gb":244,"./en-gb.js":244,"./en-ie":245,"./en-ie.js":245,"./en-il":246,"./en-il.js":246,"./en-nz":247,"./en-nz.js":247,"./eo":248,"./eo.js":248,"./es":249,"./es-do":250,"./es-do.js":250,"./es-us":251,"./es-us.js":251,"./es.js":249,"./et":252,"./et.js":252,"./eu":253,"./eu.js":253,"./fa":254,"./fa.js":254,"./fi":255,"./fi.js":255,"./fo":256,"./fo.js":256,"./fr":257,"./fr-ca":258,"./fr-ca.js":258,"./fr-ch":259,"./fr-ch.js":259,"./fr.js":257,"./fy":260,"./fy.js":260,"./ga":261,"./ga.js":261,"./gd":262,"./gd.js":262,"./gl":263,"./gl.js":263,"./gom-latn":264,"./gom-latn.js":264,"./gu":265,"./gu.js":265,"./he":266,"./he.js":266,"./hi":267,"./hi.js":267,"./hr":268,"./hr.js":268,"./hu":269,"./hu.js":269,"./hy-am":270,"./hy-am.js":270,"./id":271,"./id.js":271,"./is":272,"./is.js":272,"./it":273,"./it-ch":274,"./it-ch.js":274,"./it.js":273,"./ja":275,"./ja.js":275,"./jv":276,"./jv.js":276,"./ka":277,"./ka.js":277,"./kk":278,"./kk.js":278,"./km":279,"./km.js":279,"./kn":280,"./kn.js":280,"./ko":281,"./ko.js":281,"./ku":282,"./ku.js":282,"./ky":283,"./ky.js":283,"./lb":284,"./lb.js":284,"./lo":285,"./lo.js":285,"./lt":286,"./lt.js":286,"./lv":287,"./lv.js":287,"./me":288,"./me.js":288,"./mi":289,"./mi.js":289,"./mk":290,"./mk.js":290,"./ml":291,"./ml.js":291,"./mn":292,"./mn.js":292,"./mr":293,"./mr.js":293,"./ms":294,"./ms-my":295,"./ms-my.js":295,"./ms.js":294,"./mt":296,"./mt.js":296,"./my":297,"./my.js":297,"./nb":298,"./nb.js":298,"./ne":299,"./ne.js":299,"./nl":300,"./nl-be":301,"./nl-be.js":301,"./nl.js":300,"./nn":302,"./nn.js":302,"./pa-in":303,"./pa-in.js":303,"./pl":304,"./pl.js":304,"./pt":305,"./pt-br":306,"./pt-br.js":306,"./pt.js":305,"./ro":307,"./ro.js":307,"./ru":308,"./ru.js":308,"./sd":309,"./sd.js":309,"./se":310,"./se.js":310,"./si":311,"./si.js":311,"./sk":312,"./sk.js":312,"./sl":313,"./sl.js":313,"./sq":314,"./sq.js":314,"./sr":315,"./sr-cyrl":316,"./sr-cyrl.js":316,"./sr.js":315,"./ss":317,"./ss.js":317,"./sv":318,"./sv.js":318,"./sw":319,"./sw.js":319,"./ta":320,"./ta.js":320,"./te":321,"./te.js":321,"./tet":322,"./tet.js":322,"./tg":323,"./tg.js":323,"./th":324,"./th.js":324,"./tl-ph":325,"./tl-ph.js":325,"./tlh":326,"./tlh.js":326,"./tr":327,"./tr.js":327,"./tzl":328,"./tzl.js":328,"./tzm":329,"./tzm-latn":330,"./tzm-latn.js":330,"./tzm.js":329,"./ug-cn":331,"./ug-cn.js":331,"./uk":332,"./uk.js":332,"./ur":333,"./ur.js":333,"./uz":334,"./uz-latn":335,"./uz-latn.js":335,"./uz.js":334,"./vi":336,"./vi.js":336,"./x-pseudo":337,"./x-pseudo.js":337,"./yo":338,"./yo.js":338,"./zh-cn":339,"./zh-cn.js":339,"./zh-hk":340,"./zh-hk.js":340,"./zh-tw":341,"./zh-tw.js":341};function n(e){var t=o(e);return r(t)}function o(e){if(!r.o(map,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return map[e]}n.keys=function(){return Object.keys(map)},n.resolve=o,e.exports=n,n.id=381}}]);