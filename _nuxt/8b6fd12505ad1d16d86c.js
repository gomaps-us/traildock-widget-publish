(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{191:function(e,t,r){"use strict";var n=r(0).default.component("dropzone-loading",{data:function(){return{}},template:"<div>Loading...</div>"});(n=r(199)).autoDiscover=!1,r(200);var o={name:"Dropzone",props:{multiple:{type:Boolean,default:!1},accept:{type:String,default:null},message:{type:String,default:"Drop file here or click to upload"}},data:function(){return{}},mounted:function(){var e=this;this.dropzone=new n(this.$el,{autoProcessQueue:!1,url:"#",acceptedFiles:this.accept,uploadMultiple:this.multiple,dictDefaultMessage:this.message,addedfile:function(t){e.$emit("drop",t)},thumbnail:function(t){e.$emit("thumbnail",t)}})},beforeDestroy:function(){this.dropzone&&this.dropzone.destroy()}},l=r(20),component=Object(l.a)(o,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"dropzone dropzone-component"})},[],!1,null,null,null);t.a=component.exports},198:function(e,t,r){var content=r(372);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(37).default)("6e2a5079",content,!0,{sourceMap:!1})},367:function(e,t,r){"use strict";r(38);var n=r(6),o=r(1),l=r(2),c=r.n(l),d=(r(39),r(186)),m=r.n(d),h=(r(378),r(0).default.component("jsoneditor-loading",{data:function(){return{}},template:"<div>Loading...</div>"}));h=r(382);var v={name:"DocEditor",props:{data:{type:Object,default:function(){return{}}},ro:{type:Boolean,default:!0}},data:function(){return{editor:null}},mounted:function(){var e=this;this.editor=new h(this.$el,{onChange:function(){e.editor&&e.$emit("change",e.editor.get())},onEditable:function(){return!e.ro}}),this.editor.set(this.data)},beforeDestroy:function(){this.editor&&(this.editor.destroy(),this.editor=null)}},f=r(20),y={name:"Doc",components:{docEditor:Object(f.a)(v,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"jsoneditor",staticStyle:{height:"200px"}})},[],!1,null,"19275aac",null).exports},props:{doc:{type:Object,required:!0},organization:{type:Object,required:!1,default:null}},data:function(){return{user:null,newValue:null,saving:!1,savingError:"",deleting:!1,deletingError:"",deleted:!1}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{doc:function(){this.loadUser()}},methods:{loadUser:function(){var e=this,t=this.$app_config.traildock_api_base_url+"rest/v2/user/"+this.doc.userId;c.a.get(t).then(function(t){e.user=t.data}).catch(function(){e.user=null})},onChangeValue:function(e){this.newValue=e},onDelete:function(){var e=this;if(confirm("Really delete this doc?")){this.deleting=!0,this.deletingError="";var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key;this.organization&&this.organization.id&&(t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key+"/organization/"+this.organization.id),c.a.delete(t,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(t){e.deleting=!1,e.deleted=!0}).catch(function(t){e.deleting=!1,o.has(t,"response.data.error")?e.deletingError=t.response.data.error:e.deletingError=t.message})}},onSave:function(){var e=this;this.saving=!0,this.savingError="";var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key;this.organization&&this.organization.id&&(t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key+"/organization/"+this.organization.id),c.a.put(t,this.newValue,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(t){e.saving=!1,e.newValue=null,e.$emit("save",t.data)}).catch(function(t){e.saving=!1,o.has(t,"response.data.error")?e.savingError=t.response.data.error:e.savingError=t.message})},formatDate:function(text){return m()(text).format("dddd, MMMM Do YYYY, h:mm:ss a")},mounted:function(){this.loadUser()}}},w={name:"OrganizationElementDocs",components:{doc:Object(f.a)(y,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:!e.deleted,expression:"!deleted"}]},[r("span",{staticClass:"tag is-dark"},[e._v(e._s(e.doc.key))]),e._v(" "),r("small",[e.doc.updatedAt?r("span",[e._v("saved "+e._s(e.formatDate(e.doc.updatedAt)))]):e._e(),e._v(" "),e.user?r("span",[e._v("by "+e._s(e.user.displayName))]):e._e(),e._v(" "),r("doc-editor",{attrs:{ro:!e.authenticated,data:e.doc.value},on:{change:e.onChangeValue}})],1),e._v(" "),e.authenticated?r("div",{staticClass:"field has-addons"},[r("p",{staticClass:"control"},[r("button",{staticClass:"button is-primary",attrs:{disabled:(e.saving||!e.newValue)&&e.doc.id},on:{click:e.onSave}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.saving,expression:"!saving"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-save"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.saving,expression:"saving"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Save")])])]),e._v(" "),r("p",{staticClass:"control"},[r("button",{staticClass:"button is-danger",attrs:{disabled:e.deleting||!e.doc.id},on:{click:e.onDelete}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.deleting,expression:"!deleting"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-trash"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.deleting,expression:"deleting"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Delete")])])])]):e._e(),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.savingError,expression:"savingError"}],staticClass:"notification is-danger"},[e._v("\n    "+e._s(e.savingError)+"\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.deletingError,expression:"deletingError"}],staticClass:"notification is-danger"},[e._v("\n    "+e._s(e.deletingError)+"\n  ")])])},[],!1,null,"357a5e8e",null).exports},props:{organization:{type:Object,required:!0},elementId:{type:String,required:!0},elementType:{type:String,required:!0}},data:function(){return{docs:[],loadingDocsError:"",loadingDocs:!1,showNewDocModal:!1,newDocKey:"",newDocError:""}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{elementId:function(){this.loadDocs()}},mounted:function(){this.loadDocs()},methods:{loadDocs:function(){var e=this;this.loadingDocs=!0,this.loadingDocsError="",this.docs=[],console.log("~~ Fetching docs for "+this.elementType+" "+this.elementId+" in organization "+this.organization.name);var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.elementType+"/"+this.elementId;this.organization.id&&(t=t+"/organization/"+this.organization.id),c.a.get(t).then(function(t){e.docs=t.data,e.loadingDocs=!1}).catch(function(t){var r="";r=o.has(t,"response.data.error")?t.response.data.error:t.message,e.docs=[],e.loadingDocsError=r,e.loadingDocs=!1})},onDocSave:function(e,t){e.value=t.value,e.updatedAt=t.updatedAt,e.createdAt=t.createdAt,e.userId=t.userId,e.key=t.key,e.images=t.images,e.organizationId=t.organizationId,e.id=t.id,e.isNew=!1},onCreateNewDoc:function(){this.newDocError="";var e={};e[this.newDocKey]="",this.docs.push({docableId:this.elementId,docableType:this.elementType,key:this.newDocKey,value:e}),this.newDocKey="",this.showNewDocModal=!1}}},_=Object(f.a)(w,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("strong",{directives:[{name:"show",rawName:"v-show",value:e.organization.name,expression:"organization.name"}]},[e._v(e._s(e.organization.name))]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.loadingDocs,expression:"loadingDocs"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-spinner-third fa-spin"})]),e._v(" "),e._l(e.docs,function(t){return r("doc",{key:t.id,staticStyle:{"margin-bottom":"10px"},attrs:{doc:t,organization:e.organization},on:{save:function(r){return e.onDocSave(t,r)}}})}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.docs.length,expression:"docs.length === 0"}]},[e._v("\n    No docs found for this element.\n  ")]),e._v(" "),e.authenticated?r("div",{staticStyle:{"margin-top":"20px"}},[r("button",{staticClass:"button is-info",attrs:{disabled:!e.authenticated},on:{click:function(t){e.showNewDocModal=!0}}},[e._m(0),e._v(" "),r("span",[e._v("Add New Doc")])])]):e._e(),e._v(" "),r("div",{staticClass:"modal",class:{"is-active":e.showNewDocModal}},[r("div",{staticClass:"modal-background"}),e._v(" "),r("div",{staticClass:"modal-card"},[r("header",{staticClass:"modal-card-head"},[r("p",{staticClass:"modal-card-title"},[e._v("\n          Create New Doc\n        ")]),e._v(" "),r("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){e.showNewDocModal=!1}}})]),e._v(" "),r("section",{staticClass:"modal-card-body"},[r("div",{staticClass:"field"},[r("label",{staticClass:"label"},[e._v("Doc Key")]),e._v(" "),r("div",{staticClass:"control"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.newDocKey,expression:"newDocKey"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.newDocKey},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onCreateNewDoc(t)},input:function(t){t.target.composing||(e.newDocKey=t.target.value)}}})])])]),e._v(" "),r("footer",{staticClass:"modal-card-foot"},[r("button",{staticClass:"button is-success",on:{click:e.onCreateNewDoc}},[e._m(1),e._v(" "),r("span",[e._v("Create")])]),e._v(" "),r("button",{staticClass:"button is-primary",on:{click:function(t){e.showNewDocModal=!1}}},[e._v("\n          Cancel\n        ")])])])])],2)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa-fw fas fa-plus"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-plus"})])}],!1,null,"4f0629c7",null).exports,j={name:"OSMElementImages",components:{dropzone:r(191).a},props:{elementId:{type:String,required:!0},elementType:{type:String,required:!0}},data:function(){return{loadingImages:!1,loadingImagesError:"",images:[],maxImageSize:5e6,removingImage:!1,removingImageError:"",addingImage:!1,addingImageError:""}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]},me:function(){return this.$store.state.user.me}},watch:{elementId:function(){this.loadImages()}},mounted:function(){this.loadImages()},methods:{loadImages:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingImages=!0,e.prev=1,e.next=4,c.a.get(this.$app_config.traildock_api_base_url+"rest/v2/images/"+this.elementType+"/"+this.elementId);case 4:t=e.sent,this.images=t.data,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),this.loadingImages=!1,o.has(e.t0,"response.data.error")?this.loadingImagesError=e.t0.response.data.error:this.loadingImagesError=e.t0.message;case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}(),addImage:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.size<=this.maxImageSize)){e.next=19;break}return this.addingImage=!0,this.addingImageError="",(r=new FormData).set("imageFile",t),e.prev=5,e.next=8,c.a.post(this.$app_config.traildock_api_base_url+"rest/v2/image/attach/"+this.elementType+"/"+this.elementId,r,{headers:{Authorization:"Bearer "+this.$store.state.user.token,"content-type":"multipart/form-data"}});case 8:n=e.sent,this.addingImage=!1,this.images.push(n.data),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),o.has(e.t0,"response.data.error")?this.addingImageError=e.t0.response.data.error:this.addingImageError=e.t0.message,this.addingImage=!1;case 17:e.next=20;break;case 19:alert("Image file too large!");case 20:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}(),removeImage:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(image){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("This image will be removed from the element.  Continue?")){e.next=13;break}return this.removingImage=!0,e.prev=2,e.next=5,c.a.delete(this.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+"/detach",{headers:{Authorization:"Bearer "+this.$store.state.user.token}});case 5:this.removingImage=!1,this.images=o.filter(this.images,function(img){return img.id!==image.id}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),o.has(e.t0,"response.data.error")?this.removingImageError=e.t0.response.data.error:this.removingImageError=e.t0.message,this.removingImage=!1;case 13:case"end":return e.stop()}},e,this,[[2,9]])}));return function(t){return e.apply(this,arguments)}}(),formattedDocDate:function(e){return m()(e).format("dddd, MMMM Do YYYY, h:mm a")},showImageInModal:function(image){this.$emit("image",image.url)}}},k={name:"OSMElement",components:{organization:_,images:Object(f.a)(j,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",{staticClass:"title is-5"},[e._v("\n    Images\n  ")]),e._v(" "),e._l(e.images,function(image){return r("article",{key:image.id,staticClass:"media"},[r("figure",{staticClass:"media-left"},[r("p",{staticClass:"image is-128x128"},[r("a",{on:{click:function(t){return t.preventDefault(),e.showImageInModal(image)}}},[r("img",{staticStyle:{width:"128px"},attrs:{src:image.url}})])])]),e._v(" "),r("div",{staticClass:"media-content"},[r("div",{staticClass:"content"},[r("p",[image.user?r("span",[e._v("by ")]):e._e(),image.user?r("strong",[e._v(e._s(image.user.displayName))]):e._e(),e._v(" "),r("small",[e._v(e._s(e.formattedDocDate(image.createdAt)))])])]),e._v(" "),r("nav",{staticClass:"level is-mobile"},[r("div",{staticClass:"level-left"},[r("a",{on:{click:function(t){return t.preventDefault(),e.showImageInModal(image)}}},[e._m(0,!0)])])])]),e._v(" "),r("div",{staticClass:"media-right"},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.authenticated&&e.me&&image.user&&e.me.id===image.user.id,expression:"authenticated && me && image.user && me.id === image.user.id"}],staticClass:"delete",on:{click:function(t){return e.removeImage(image)}}})])])}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.images.length,expression:"images.length === 0"}]},[e._v("\n    No images have been attached to this element.\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.authenticated,expression:"authenticated"}],staticClass:"field"},[r("div",{staticClass:"control"},[r("dropzone",{attrs:{multiple:!0,message:'<a href="javascript:;" class="upload-link">Drop file here or click to select an image</a>',accept:"image/*"},on:{thumbnail:e.addImage}})],1),e._v(" "),r("p",{staticClass:"help"},[e._v("\n      5Mb max filesize\n    ")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.removingImage,expression:"removingImage"}],staticClass:"notification is-primary"},[e._v("\n    Removing image from element "),e._m(1)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.addingImage,expression:"addingImage"}],staticClass:"notification is-primary"},[e._v("\n    Adding image to element "),e._m(2)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.addingImageError,expression:"addingImageError"}],staticClass:"notification is-danger"},[r("button",{staticClass:"delete",on:{click:function(t){e.addingImageError=""}}}),e._v("\n    "+e._s(e.addingImageError)+"\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.removingImageError,expression:"removingImageError"}],staticClass:"notification is-danger"},[r("button",{staticClass:"delete",on:{click:function(t){e.removingImageError=""}}}),e._v("\n    "+e._s(e.removingImageError)+"\n  ")])],2)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon is-small"},[t("i",{staticClass:"fas fa-expand"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-spinner-third fa-spin"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-spinner-third fa-spin"})])}],!1,null,"5ba5fb99",null).exports},props:{elementId:{type:String,required:!0}},data:function(){return{elementName:"",modalImageUrl:"",centerWait:!1,centerNodeId:"",osmTags:[],memberships:[]}},computed:{elementType:function(){if(console.log(this.elementId),this.elementId&&this.elementId.length>0)switch(this.elementId[0]){case"w":return"way";case"n":return"node";default:return"relation"}return""},elementRawId:function(){return o.trimStart(this.elementId,"wnr")}},watch:{elementId:function(){this.loadElementInfo()},"$store.state.user.me":function(){this.loadMemberships()}},mounted:function(){this.loadElementInfo(),this.loadMemberships()},methods:{sendCenterEvent:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r,n,o,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.centerWait=!0,e.prev=1,e.next=4,c.a.get("https://api.openstreetmap.org/api/0.6/node/"+this.centerNodeId);case 4:t=e.sent,r=new DOMParser,n=r.parseFromString(t.data,"text/xml"),(o=n.getElementsByTagName("node"))&&o.length>0&&(l=o[0].getAttribute("lat"),d=o[0].getAttribute("lon"),l&&d&&this.$emit("center",{lat:l,lng:d})),this.centerWait=!1,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.centerWait=!1;case 15:case"end":return e.stop()}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}(),loadElementInfo:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r,n,o,i,l,d,m,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.elementType){e.next=11;break}return e.next=3,c.a.get("https://api.openstreetmap.org/api/0.6/"+this.elementType+"/"+this.elementRawId);case 3:for(t=e.sent,this.elementName="",r=new DOMParser,n=r.parseFromString(t.data,"text/xml"),o=n.getElementsByTagName("tag"),i=0;i<o.length;i++)"name"===(l=o[i]).getAttribute("k")&&(d=l.getAttribute("v"))&&(this.elementName=d),this.osmTags.push({key:l.getAttribute("k"),value:l.getAttribute("v")});(m=n.getElementsByTagName("nd"))&&m.length>0&&(h=m[0].getAttribute("ref"))&&(this.centerNodeId=h);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),loadMemberships:function(){var e=this;this.memberships=[],this.$store.state.user.me&&this.$store.dispatch("user/goFetchMemberships",{}).then(function(t){e.memberships=t})},showImageModal:function(e){e&&(this.modalImageUrl=e)}}},x=Object(f.a)(k,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.elementType,expression:"elementType"}]},[r("div",{},[r("div",{},[r("h1",{staticClass:"title is-3"},[e._v("\n        "+e._s(e.elementName)+"\n      ")]),e._v(" "),r("h2",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.elementType)+" "+e._s(e.elementRawId)+"\n      ")])]),e._v(" "),r("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.centerNodeId,expression:"centerNodeId"}],staticClass:"button is-small",on:{click:e.sendCenterEvent}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.centerWait,expression:"!centerWait"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-fw fa-location"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.centerWait,expression:"centerWait"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-fw fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Center In Map")])])])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.osmTags.length>0&&!e.$store.state.ideditor.isEmbedded,expression:"osmTags.length > 0 && !$store.state.ideditor.isEmbedded"}],staticClass:"field is-grouped is-grouped-multiline"},e._l(e.osmTags,function(t){return r("div",{key:t.key,staticClass:"control"},[r("div",{staticClass:"tag",class:{"is-success":"yes"===t.value||"designated"===t.value,"is-danger":"no"===t.value}},[e._v("\n        "+e._s(t.key)+" : "+e._s(t.value)+"\n      ")])])}),0),e._v(" "),r("organization",{staticStyle:{"margin-bottom":"20px"},attrs:{organization:{name:"",id:null},"element-type":e.elementType,"element-id":e.elementRawId}}),e._v(" "),e._l(e.memberships,function(t){return r("div",{key:t.id,staticClass:"box"},[r("organization",{attrs:{organization:t,"element-type":e.elementType,"element-id":e.elementRawId}})],1)}),e._v(" "),r("images",{attrs:{"element-type":e.elementType,"element-id":e.elementRawId},on:{image:e.showImageModal}}),e._v(" "),r("hr"),e._v(" "),r("div",{staticClass:"modal",class:{"is-active":e.modalImageUrl}},[r("div",{staticClass:"modal-background"}),e._v(" "),r("div",{staticClass:"modal-content"},[r("p",{staticClass:"image is-4by3"},[r("img",{attrs:{src:e.modalImageUrl,alt:""}})])]),e._v(" "),r("button",{staticClass:"modal-close is-large is-primary",attrs:{"aria-label":"close"},on:{click:function(t){e.modalImageUrl=null}}})])],2)},[],!1,null,"3f7c9dcd",null);t.a=x.exports},368:function(e,t,r){"use strict";r(39),r(103),r(55),r(369),r(54),r(104),r(28),r(29),r(11);var n=r(1),o=r(370),l=r.n(o),c={"all_trails-04-28-8yvqeu":"mapbox://traildock-d.ad7igrv6","CO_all_trails-06-17-ah1o4v":"mapbox://traildock-d.cffx5ks1",ustrails14:"composite"},d=n.keys(c),m={name:"TraildockMap",props:{startLocation:{type:Object,required:null,default:function(){return{}}},showObservationMarker:{type:Object,required:null,default:function(){return{}}},rememberLocation:{type:Boolean,default:!0},rememberLocationKey:{type:String,default:"traildock_map"},observations:{type:Array,default:function(){return[]}}},data:function(){return{map:null,mapLat:0,mapLng:0,mapZoom:0,selectedLayers:[],highlightLayerAdded:!1,observationMarker:null,observationMarkers:[],startingMapLat:localStorage.getItem(this.rememberLocationKey+":mapLat")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapLat")||"38.870010"):38.87001,startingMapLng:localStorage.getItem(this.rememberLocationKey+":mapLng")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapLng")||"-106.980974"):-106.980974,startingMapZoom:localStorage.getItem(this.rememberLocationKey+":mapZoom")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapZoom")||"12"):12}},computed:{me:function(){return this.$store.state.user.me}},watch:{mapLat:function(){this.mapLat&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapLat",this.mapLat+"")},mapLng:function(){this.mapLng&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapLng",this.mapLng+"")},mapZoom:function(){this.mapZoom&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapZoom",this.mapZoom+"")},showObservationMarker:function(){if(this.map)if(n.isEmpty(this.showObservationMarker))this.observationMarker&&this.observationMarker.remove();else{if(!this.observationMarker){var e=l.a.parseHTML('<div class="observationMarker new" style="text-align: center;"><i style="font-size: 36px; color: #FF0000;" class="far fa-map-marker-alt"></i></div>');this.observationMarker=new mapboxgl.Marker(e[0]).setOffset([0,-18]).setLngLat(new mapboxgl.LngLat(this.showObservationMarker.lng,this.showObservationMarker.lat))}this.observationMarker.setLngLat(new mapboxgl.LngLat(this.showObservationMarker.lng,this.showObservationMarker.lat)),this.observationMarker.addTo(this.map)}},observations:function(){var e=this,t=[],r=[],o=[],l=!0,c=!1,d=void 0;try{for(var m,h=function(){var r=m.value;n.find(e.observationMarkers,function(e){return e._observation.properties.id===r.properties.id})||t.push(r),r._forceMapUpdate&&(o.push(r.properties.id),t.push(r))},v=this.observations[Symbol.iterator]();!(l=(m=v.next()).done);l=!0)h()}catch(e){c=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw d}}var f=!0,y=!1,w=void 0;try{for(var _,j=function(){var marker=_.value,t=marker;n.find(e.observations,function(e){return e.properties.id===t._observation.properties.id})||r.push(marker),n.indexOf(o,t._observation.properties.id)>=0&&r.push(marker)},k=this.observationMarkers[Symbol.iterator]();!(f=(_=k.next()).done);f=!0)j()}catch(e){y=!0,w=e}finally{try{f||null==k.return||k.return()}finally{if(y)throw w}}for(var x=0;x<r.length;x++){r[x].remove()}for(var I=0;I<t.length;I++){var C=t[I];this.addObservation(C)}o&&this.$emit("marker-forced",o)}},mounted:function(){this.loadMap()},beforeDestroy:function(){this.map&&this.map.remove()},methods:{highlightSelectedLayers:function(){if(this.map.isStyleLoaded()&&!this.highlightLayerAdded&&(this.highlightLayerAdded=!0,this.map.addSource("highlight",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"highlight",type:"line",source:"highlight",paint:{"line-color":"yellow","line-opacity":.75,"line-width":8}})),this.highlightLayerAdded){var source=this.map.getSource("highlight");source&&source.setData({type:"FeatureCollection",features:[]});var e=[],t=!0,r=!1,n=void 0;try{for(var o,l=this.selectedLayers[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var c=o.value,d=this.map.querySourceFeatures(c.source,{sourceLayer:c.sourceLayer,filter:[c.filterOp,c.filterField,c.filterCompare]}),m=!0,h=!1,v=void 0;try{for(var f,y=d[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var w=f.value;e.push(w.toJSON())}}catch(e){h=!0,v=e}finally{try{m||null==y.return||y.return()}finally{if(h)throw v}}}}catch(e){r=!0,n=e}finally{try{t||null==l.return||l.return()}finally{if(r)throw n}}if(this.highlightLayerAdded&&e)if(e.length>1){var _={type:"FeatureCollection",features:e};source.setData(_)}else 1===e.length&&source.setData(e[0])}},loadMap:function(){var e=this,t=this.startingMapLat,r=this.startingMapLng,o=this.startingMapZoom;this.startLocation&&(n.has(this.startLocation,"lat")&&(t=this.startLocation.lat),n.has(this.startLocation,"lng")&&(r=this.startLocation.lng),n.has(this.startLocation,"zoom")&&(o=this.startLocation.zoom)),n.set(mapboxgl,"accessToken",this.$app_config.mapbox_access_token),this.map=new mapboxgl.Map({container:this.$el,style:this.$app_config.mapbox_base_style,center:new mapboxgl.LngLat(r,t),zoom:o,logoPosition:"top-left"}),this.map&&(this.map.addControl(new mapboxgl.NavigationControl),this.map.on("load",function(){console.log("~~ map load"),setTimeout(function(){e.highlightRouteIds()},500),e.map.on("moveend",function(t){var r=e.map.getBounds().getCenter();e.mapLat=r.lat,e.mapLng=r.lng,e.highlightSelectedLayers(),e.$emit("newbounds")}),e.map.on("zoomend",function(t){e.mapZoom=e.map.getZoom(),e.highlightSelectedLayers(),e.$emit("newbounds")}),e.$emit("newbounds")}),this.map.on("mousemove",function(t){var r=e.map.queryRenderedFeatures(t.point),o=!1,l=!0,c=!1,m=void 0;try{for(var h,v=r[Symbol.iterator]();!(l=(h=v.next()).done);l=!0){var f=h.value,y=f.layer["source-layer"];n.indexOf(d,y)>=0?o=!0:f.id&&(f.id+"").length>1&&(o=!0)}}catch(e){c=!0,m=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw m}}e.map.getCanvas().style.cursor=o?"pointer":""}),this.map.on("click",function(t){if(n.isEmpty(e.showObservationMarker)){e.selectedLayers=[];var r=[[t.point.x-5,t.point.y-5],[t.point.x+5,t.point.y+5]],o=e.map.queryRenderedFeatures(r),l=[],c=!0,m=!1,h=void 0;try{for(var v,f=o[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var y=v.value,w=null,_=y.layer["source-layer"];if(n.indexOf(d,_)>=0){if(y.properties&&(w=y.properties.id.replace("way/","w"))&&n.indexOf(l,w)<0){l.push(w);var j=y;e.selectedLayers.push({source:j.source,sourceLayer:j.sourceLayer,filterOp:"==",filterField:"id",filterCompare:y.properties.id})}}else if(y.id&&(y.id+"").length>2&&(n.endsWith(y.id+"","0")&&(w="n"+Math.floor(+y.id/10)),n.endsWith(y.id+"","1")&&(w="w"+Math.floor(+y.id/10)),n.endsWith(y.id+"","4")&&(w="r"+Math.floor(+y.id/10)),w&&n.indexOf(l,w)<0)){l.push(w);var k=y;e.selectedLayers.push({source:k.source,sourceLayer:k.sourceLayer,filterOp:"==",filterField:"$id",filterCompare:y.id})}}}catch(e){m=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(m)throw h}}l=n.compact(n.uniq(l)),e.$store.commit("ideditor/setSelectedIds",{selectedIds:l}),e.highlightSelectedLayers()}else{var x=t.lngLat.lat,I=t.lngLat.lng;e.$emit("observation-marker-move",{lat:x,lng:I})}}))},highlightRouteIds:function(){if(this.$route.query.ids){var e=this.$route.query.ids.split(","),t=!0,r=!1,o=void 0;try{for(var l,m=e[Symbol.iterator]();!(t=(l=m.next()).done);t=!0){var h=l.value;if(n.startsWith(h,"w")){this.selectedLayers.push({source:"composite",sourceLayer:"road",filterOp:"==",filterField:"$id",filterCompare:parseInt(n.trimStart(h,"w")+"1")});var v=!0,f=!1,y=void 0;try{for(var w,_=d[Symbol.iterator]();!(v=(w=_.next()).done);v=!0){var j=w.value;this.selectedLayers.push({source:c[j],sourceLayer:j,filterOp:"==",filterField:"id",filterCompare:"way/"+n.trimStart(h,"w")})}}catch(e){f=!0,y=e}finally{try{v||null==_.return||_.return()}finally{if(f)throw y}}}}}catch(e){r=!0,o=e}finally{try{t||null==m.return||m.return()}finally{if(r)throw o}}this.highlightSelectedLayers()}},center:function(e){this.map&&this.map.panTo(new mapboxgl.LngLat(e.lng,e.lat))},getCenter:function(){if(this.map)return this.map.getBounds().getCenter()},bounds:function(){return this.map?this.map.getBounds():null},resize:function(e){this.map&&this.map.resize()},addObservation:function(e){var t=this,r=null,o="";if(n.indexOf(e.properties.tags,"type:report")>-1){o="report";r=l.a.parseHTML('<div class="observationMarker report" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #0000FF;" class="fas fa-exclamation-circle"></i></div>')}else if(n.indexOf(e.properties.tags,"type:trailhead")>-1){o="trailhead";r=l.a.parseHTML('<div class="observationMarker trailhead" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #8B4513;" class="fas fa-sign"></i></div>')}else if(n.indexOf(e.properties.tags,"type:sign")>-1){o="sign";r=l.a.parseHTML('<div class="observationMarker sign" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #25912c;" class="fas fa-map-signs"></i></div>')}else{r=l.a.parseHTML('<div class="observationMarker" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #ffff00;" class="fas fa-sticky-note"></i></div>')}if(r){var marker=new mapboxgl.Marker(r[0]).setLngLat(e.geometry.coordinates),c='<div style="max-width: 200px;">';if(n.has(e,"properties.name")&&e.properties.name?c=c+"<div><strong>"+n.escape(e.properties.name)+"</strong></div>":c+="<div><strong>Observation</strong></div>",n.has(e,"properties.description")&&(c=c+"<div>"+n.escape(e.properties.description)+"</div>"),"trailhead"===o&&(c=c+'<div><a href="https://www.google.com/maps/dir/?api=1&destination='+e.geometry.coordinates[1]+","+e.geometry.coordinates[0]+'" target="_blank">Driving Directions</a></div>'),n.has(e,"properties.tags")&&e.properties.tags){c+='<div style="margin-bottom: 5px;">';var d=!0,m=!1,h=void 0;try{for(var v,f=e.properties.tags[Symbol.iterator]();!(d=(v=f.next()).done);d=!0){var y=v.value;y&&(c=c+'<span class="tag">'+y+"</span>")}}catch(e){m=!0,h=e}finally{try{d||null==f.return||f.return()}finally{if(m)throw h}}c+="</div>"}if(n.has(e,"properties.images")&&e.properties.images){var w=!0,_=!1,j=void 0;try{for(var k,x=e.properties.images[Symbol.iterator]();!(w=(k=x.next()).done);w=!0){var image=k.value;c=c+'<div><img style="cursor: pointer;" style="width: 128px;" data-uri="'+image.url+'" src="'+this.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+'/resize?width=128&height=128"/></div>'}}catch(e){_=!0,j=e}finally{try{w||null==x.return||x.return()}finally{if(_)throw j}}}this.me&&(this.me.id===e.properties.user.id||this.me.isSuperuser)&&(c+='<div><button class="button is-small is-primary edit">Edit</button><button class="button is-small is-danger destroy">Delete</button></div>'),c+="</div>";var I=l()(l.a.parseHTML(c));I.find("img").on("click",function(e){t.$emit("show-observation-image",l()(e.target).attr("data-uri"))}),I.find("button.destroy").on("click",function(r){t.$emit("delete-observation",e)}),I.find("button.edit").on("click",function(r){t.$emit("edit-observation",e)});var C=(new mapboxgl.Popup).setDOMContent(I[0]);marker.setPopup(C),marker._observation=e,this.observationMarkers.push(marker),marker.addTo(this.map)}}}},h=(r(371),r(20)),component=Object(h.a)(m,function(){var e=this.$createElement;return(this._self._c||e)("div")},[],!1,null,null,null);t.a=component.exports},371:function(e,t,r){"use strict";var n=r(198);r.n(n).a},372:function(e,t,r){(e.exports=r(36)(!1)).push([e.i,".observationMarker{cursor:pointer}",""])},375:function(e,t,r){var map={"./af":211,"./af.js":211,"./ar":212,"./ar-dz":213,"./ar-dz.js":213,"./ar-kw":214,"./ar-kw.js":214,"./ar-ly":215,"./ar-ly.js":215,"./ar-ma":216,"./ar-ma.js":216,"./ar-sa":217,"./ar-sa.js":217,"./ar-tn":218,"./ar-tn.js":218,"./ar.js":212,"./az":219,"./az.js":219,"./be":220,"./be.js":220,"./bg":221,"./bg.js":221,"./bm":222,"./bm.js":222,"./bn":223,"./bn.js":223,"./bo":224,"./bo.js":224,"./br":225,"./br.js":225,"./bs":226,"./bs.js":226,"./ca":227,"./ca.js":227,"./cs":228,"./cs.js":228,"./cv":229,"./cv.js":229,"./cy":230,"./cy.js":230,"./da":231,"./da.js":231,"./de":232,"./de-at":233,"./de-at.js":233,"./de-ch":234,"./de-ch.js":234,"./de.js":232,"./dv":235,"./dv.js":235,"./el":236,"./el.js":236,"./en-SG":237,"./en-SG.js":237,"./en-au":238,"./en-au.js":238,"./en-ca":239,"./en-ca.js":239,"./en-gb":240,"./en-gb.js":240,"./en-ie":241,"./en-ie.js":241,"./en-il":242,"./en-il.js":242,"./en-nz":243,"./en-nz.js":243,"./eo":244,"./eo.js":244,"./es":245,"./es-do":246,"./es-do.js":246,"./es-us":247,"./es-us.js":247,"./es.js":245,"./et":248,"./et.js":248,"./eu":249,"./eu.js":249,"./fa":250,"./fa.js":250,"./fi":251,"./fi.js":251,"./fo":252,"./fo.js":252,"./fr":253,"./fr-ca":254,"./fr-ca.js":254,"./fr-ch":255,"./fr-ch.js":255,"./fr.js":253,"./fy":256,"./fy.js":256,"./ga":257,"./ga.js":257,"./gd":258,"./gd.js":258,"./gl":259,"./gl.js":259,"./gom-latn":260,"./gom-latn.js":260,"./gu":261,"./gu.js":261,"./he":262,"./he.js":262,"./hi":263,"./hi.js":263,"./hr":264,"./hr.js":264,"./hu":265,"./hu.js":265,"./hy-am":266,"./hy-am.js":266,"./id":267,"./id.js":267,"./is":268,"./is.js":268,"./it":269,"./it-ch":270,"./it-ch.js":270,"./it.js":269,"./ja":271,"./ja.js":271,"./jv":272,"./jv.js":272,"./ka":273,"./ka.js":273,"./kk":274,"./kk.js":274,"./km":275,"./km.js":275,"./kn":276,"./kn.js":276,"./ko":277,"./ko.js":277,"./ku":278,"./ku.js":278,"./ky":279,"./ky.js":279,"./lb":280,"./lb.js":280,"./lo":281,"./lo.js":281,"./lt":282,"./lt.js":282,"./lv":283,"./lv.js":283,"./me":284,"./me.js":284,"./mi":285,"./mi.js":285,"./mk":286,"./mk.js":286,"./ml":287,"./ml.js":287,"./mn":288,"./mn.js":288,"./mr":289,"./mr.js":289,"./ms":290,"./ms-my":291,"./ms-my.js":291,"./ms.js":290,"./mt":292,"./mt.js":292,"./my":293,"./my.js":293,"./nb":294,"./nb.js":294,"./ne":295,"./ne.js":295,"./nl":296,"./nl-be":297,"./nl-be.js":297,"./nl.js":296,"./nn":298,"./nn.js":298,"./pa-in":299,"./pa-in.js":299,"./pl":300,"./pl.js":300,"./pt":301,"./pt-br":302,"./pt-br.js":302,"./pt.js":301,"./ro":303,"./ro.js":303,"./ru":304,"./ru.js":304,"./sd":305,"./sd.js":305,"./se":306,"./se.js":306,"./si":307,"./si.js":307,"./sk":308,"./sk.js":308,"./sl":309,"./sl.js":309,"./sq":310,"./sq.js":310,"./sr":311,"./sr-cyrl":312,"./sr-cyrl.js":312,"./sr.js":311,"./ss":313,"./ss.js":313,"./sv":314,"./sv.js":314,"./sw":315,"./sw.js":315,"./ta":316,"./ta.js":316,"./te":317,"./te.js":317,"./tet":318,"./tet.js":318,"./tg":319,"./tg.js":319,"./th":320,"./th.js":320,"./tl-ph":321,"./tl-ph.js":321,"./tlh":322,"./tlh.js":322,"./tr":323,"./tr.js":323,"./tzl":324,"./tzl.js":324,"./tzm":325,"./tzm-latn":326,"./tzm-latn.js":326,"./tzm.js":325,"./ug-cn":327,"./ug-cn.js":327,"./uk":328,"./uk.js":328,"./ur":329,"./ur.js":329,"./uz":330,"./uz-latn":331,"./uz-latn.js":331,"./uz.js":330,"./vi":332,"./vi.js":332,"./x-pseudo":333,"./x-pseudo.js":333,"./yo":334,"./yo.js":334,"./zh-cn":335,"./zh-cn.js":335,"./zh-hk":336,"./zh-hk.js":336,"./zh-tw":337,"./zh-tw.js":337};function n(e){var t=o(e);return r(t)}function o(e){if(!r.o(map,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return map[e]}n.keys=function(){return Object.keys(map)},n.resolve=o,e.exports=n,n.id=375}}]);