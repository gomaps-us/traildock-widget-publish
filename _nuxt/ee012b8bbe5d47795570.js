(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{204:function(t,e,n){var content=n(444);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(37).default)("61cba3cf",content,!0,{sourceMap:!1})},443:function(t,e,n){"use strict";var r=n(204);n.n(r).a},444:function(t,e,n){(t.exports=n(36)(!1)).push([t.i,'.splitFlex{display:flex;flex-direction:row;height:100vh}.splitFlexCol{flex-grow:1}.gutter{background-color:#eee;background-repeat:no-repeat;background-position:50%}.gutter.gutter-horizontal{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==");cursor:ew-resize}.gutter.gutter-vertical{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=");cursor:ns-resize}.embedMapSidebar{height:100vh;overflow-y:scroll}',""])},507:function(t,e,n){"use strict";n.r(e);n(104),n(28),n(29),n(11),n(38);var r=n(6),o=(n(55),n(2)),l=n.n(o),c=n(1),d=n(368),v=(n(54),n(39),n(210),n(186)),m=n.n(v),h=n(191),f=(n(192),n(338)),_={name:"CreateObservation",components:{dropzone:h.a,flatPickr:f},props:{lat:{type:Number,required:!0},lng:{type:Number,required:!0}},data:function(){return{observationLat:0,observationLng:0,observedAt:m()().format("YYYY-MM-DD HH:mm"),datePickerConfig:{enableTime:!0,dateFormat:"Y-m-d H:i",maxDate:m()().add(1,"day").toDate()},name:"",description:"",tag:"",tags:[],images:[],submitting:!1,submittingError:"",submittingProgress:0,maxImageSize:5e6,observationType:"",organizationId:"",memberships:[]}},computed:{isValid:function(){return this.name&&this.observationLat&&this.observationLng&&this.observedAt&&!this.tag},authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{"$store.state.user.me":function(){this.loadMemberships()},lat:function(){this.observationLat=this.lat},lng:function(){this.observationLng=this.lng},observationType:function(t,e){this.removeTag(e),t&&this.tags.push(t)}},mounted:function(){this.observationLat=this.lat,this.observationLng=this.lng,this.loadMemberships()},methods:{loadMemberships:function(){var t=this;this.memberships=[],this.$store.state.user.me&&this.$store.dispatch("user/goFetchMemberships",{}).then(function(e){t.memberships=e})},sendCancelEvent:function(){this.resetForm(),this.$emit("cancel")},resetForm:function(){this.name="",this.description="",this.tags=[],this.images=[],this.observationLat=0,this.observationLng=0,this.observationType=""},addTag:function(){var t=this.tag.toLowerCase().replace(/\s+/,"_").replace(/[\W]+/g,"");c.indexOf(this.tags,t)>-1?this.tag="":t&&(this.tags.push(t),this.tag="")},removeTag:function(t){this.tags=c.without(this.tags,t)},addImage:function(t){this.images.push(t)},removeImage:function(t){this.images=c.without(this.images,t)},createObservation:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var e,n,r,o,d,v,h,image,f,_=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.submitting=!0,this.submittingError="",(e=new FormData).set("name",this.name),e.set("latitude",this.observationLat+""),e.set("longitude",this.observationLng+""),e.set("source","cbgtrails_web"),this.organizationId&&e.set("organizationId",this.organizationId+""),this.description&&e.set("description",this.description),this.observedAt&&e.set("observedAt",m()(this.observedAt).format()),n="type:observation",this.tags&&(n=this.tags.join(",")),e.set("tags",n),!this.images){t.next=33;break}for(r=!0,o=!1,d=void 0,t.prev=17,v=this.images[Symbol.iterator]();!(r=(h=v.next()).done);r=!0)(image=h.value).size<=this.maxImageSize&&e.append("images",image);t.next=25;break;case 21:t.prev=21,t.t0=t.catch(17),o=!0,d=t.t0;case 25:t.prev=25,t.prev=26,r||null==v.return||v.return();case 28:if(t.prev=28,!o){t.next=31;break}throw d;case 31:return t.finish(28);case 32:return t.finish(25);case 33:return t.prev=33,t.next=36,l.a.post(this.$app_config.traildock_api_base_url+"rest/v2/observation/multipart",e,{headers:{Authorization:"Bearer "+this.$store.state.user.token,"content-type":"multipart/form-data"},onUploadProgress:function(t){t.total>0?_.submittingProgress=t.loaded/t.total:_.submittingProgress=0}});case 36:f=t.sent,this.submitting=!1,this.resetForm(),this.$emit("done",f.data),t.next=46;break;case 42:t.prev=42,t.t1=t.catch(33),this.submitting=!1,c.has(t.t1,"response.data.error")?this.submittingError=t.t1.response.data.error:this.submittingError=t.t1.message;case 46:case"end":return t.stop()}},t,this,[[17,21,25,33],[26,,28,32],[33,42]])}));return function(){return t.apply(this,arguments)}}()}},C=n(20),w=Object(C.a)(_,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.authenticated,expression:"authenticated"}]},[n("div",{staticClass:"field has-addons"},[t._m(0),t._v(" "),n("p",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationLat,expression:"observationLat"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.observationLat},on:{input:function(e){e.target.composing||(t.observationLat=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"field has-addons"},[t._m(1),t._v(" "),n("p",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationLng,expression:"observationLng"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.observationLng},on:{input:function(e){e.target.composing||(t.observationLng=e.target.value)}}})])]),t._v(" "),n("p",{staticClass:"help"},[t._v("\n      Click map to set latitude and longitude.\n    ")]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Report Date")]),t._v(" "),n("div",{staticClass:"control"},[n("flat-pickr",{staticClass:"input",attrs:{value:t.observedAt,config:t.datePickerConfig},model:{value:t.observedAt,callback:function(e){t.observedAt=e},expression:"observedAt"}})],1)]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Title")]),t._v(" "),n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"input",class:{"is-danger":!t.name},attrs:{type:"text",placeholder:"Observation Title"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),t._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:!t.name,expression:"!name"}],staticClass:"help is-danger"},[t._v("\n        A title is required!\n      ")])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Description")]),t._v(" "),n("div",{staticClass:"control"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"textarea",attrs:{placeholder:"Observation Description"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Observation Type")]),t._v(" "),n("div",{staticClass:"control"},[n("div",[n("label",{staticClass:"radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationType,expression:"observationType"}],attrs:{type:"radio",value:"type:report"},domProps:{checked:t._q(t.observationType,"type:report")},on:{change:function(e){t.observationType="type:report"}}}),t._v(" Trail Report")])]),t._v(" "),n("div",[n("label",{staticClass:"radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationType,expression:"observationType"}],attrs:{type:"radio",value:"type:trailhead"},domProps:{checked:t._q(t.observationType,"type:trailhead")},on:{change:function(e){t.observationType="type:trailhead"}}}),t._v(" Trailhead")])]),t._v(" "),n("div",[n("label",{staticClass:"radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationType,expression:"observationType"}],attrs:{type:"radio",value:"type:sign"},domProps:{checked:t._q(t.observationType,"type:sign")},on:{change:function(e){t.observationType="type:sign"}}}),t._v(" Trail Sign")])])])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Tags")]),t._v(" "),n("div",{staticClass:"field has-addons"},[n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.tag,expression:"tag"}],staticClass:"input",attrs:{type:"text",placeholder:"Tag"},domProps:{value:t.tag},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag(e)},input:function(e){e.target.composing||(t.tag=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"control",on:{click:t.addTag}},[n("a",{staticClass:"button is-primary"},[t._v("\n            Add\n          ")])])])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.tags.length>0,expression:"tags.length > 0"}],staticClass:"columns"},[n("div",{staticClass:"column field is-grouped is-grouped-multiline"},t._l(t.tags,function(e,r){return n("div",{key:r,staticClass:"control"},[n("div",{staticClass:"tag is-info"},[t._v("\n            "+t._s(e)+"\n             "),n("button",{staticClass:"delete is-small",on:{click:function(n){return t.removeTag(e)}}})])])}),0)]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Images")]),t._v(" "),n("div",{staticClass:"control"},[n("dropzone",{attrs:{multiple:!0,message:'<a href="javascript:;" class="upload-link">Drop file here or click to select an image</a>',accept:"image/*"},on:{thumbnail:t.addImage}})],1),t._v(" "),n("p",{staticClass:"help"},[t._v("\n        5Mb max filesize\n      ")])]),t._v(" "),n("div",{staticClass:"columns is-multiline"},t._l(t.images,function(e){return n("div",{key:e.upload.uuid},[n("div",{staticClass:"column"},[n("figure",{staticClass:"image"},[n("img",{staticStyle:{width:"128px"},attrs:{src:e.dataURL}})]),t._v(" "),n("button",{staticClass:"button is-small is-primary",on:{click:function(n){return t.removeImage(e)}}},[t._v("\n            Remove\n          ")]),t._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:e.size>t.maxImageSize,expression:"file.size > maxImageSize"}],staticClass:"help is-danger"},[t._v("\n            File too large!\n          ")])])])}),0),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.memberships.length>0,expression:"memberships.length > 0"}],staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Create in Organization")]),t._v(" "),n("div",{staticClass:"select"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.organizationId,expression:"organizationId"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.organizationId=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:""}},[t._v("\n            Traildock\n          ")]),t._v(" "),t._l(t.memberships,function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v("\n            "+t._s(e.name)+"\n          ")])})],2)])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.submittingError,expression:"submittingError"}],staticClass:"notification is-danger"},[t._v("\n      "+t._s(t.submittingError)+"\n    ")]),t._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:t.tag,expression:"tag"}],staticClass:"help is-danger"},[t._v("\n      You have an un-added tag.\n    ")]),t._v(" "),n("div",{staticClass:"field is-grouped"},[n("p",{staticClass:"control"},[n("button",{staticClass:"button is-primary",attrs:{disabled:!t.isValid||t.submitting},on:{click:t.createObservation}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.submitting,expression:"!submitting"}],staticClass:"icon"},[n("i",{staticClass:"fas fa-plus"})]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.submitting,expression:"submitting"}],staticClass:"icon"},[n("i",{staticClass:"fas fa-spinner-third fa-spin"})]),t._v(" "),n("span",[t._v("Submit")])])]),t._v(" "),n("p",{staticClass:"control"},[n("button",{staticClass:"button is-light",attrs:{disabled:t.submitting},on:{click:t.sendCancelEvent}},[t._v("\n          Cancel\n        ")])])])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"control"},[e("a",{staticClass:"button is-static"},[this._v("\n          Latitude\n        ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"control"},[e("a",{staticClass:"button is-static"},[this._v("\n          Longitude\n        ")])])}],!1,null,null,null).exports,y=(n(40),n(41),n(103),n(338)),x={name:"EditObservation",components:{dropzone:h.a,flatPickr:y},props:{lat:{type:Number,required:!0},lng:{type:Number,required:!0},observation:{type:Object,required:!0}},data:function(){return{observationLat:0,observationLng:0,observedAt:m()().format("YYYY-MM-DD HH:mm"),datePickerConfig:{enableTime:!0,dateFormat:"Y-m-d H:i",maxDate:m()().add(1,"day").toDate(),parseDate:function(t){return m()(t,"YYYY-MM-DD HH:mm").toDate()}},name:"",description:"",tag:"",tags:[],images:[],saving:!1,savingError:"",maxImageSize:5e6,removingImage:!1,removingImageError:"",addingImage:!1,addingImageError:"",observationType:"",organizationId:"",memberships:[]}},computed:{isValid:function(){return this.name&&this.observationLat&&this.observationLng&&this.observedAt&&!this.tag},authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{lat:function(t,e){this.observationLat=this.lat},lng:function(){this.observationLng=this.lng},observation:function(){this.updateStateFromProp()},observationType:function(t,e){this.removeTag(e),t&&this.tags.push(t)},"$store.state.user.me":function(){this.loadMemberships()}},mounted:function(){this.updateStateFromProp(),this.loadMemberships()},methods:{loadMemberships:function(){var t=this;this.memberships=[],this.$store.state.user.me&&this.$store.dispatch("user/goFetchMemberships",{}).then(function(e){t.memberships=e})},updateStateFromProp:function(){this.observation?(this.name=this.observation.properties.name,this.description=this.observation.properties.description,this.tags=c.filter(this.observation.properties.tags,function(t){return!c.startsWith(t,"type:")}),this.observationLat=this.lat,this.observationLng=this.lng,this.images=this.observation.properties.images,this.observedAt=m()(this.observation.properties.observedAt).format("YYYY-MM-DD HH:mm"),this.observationType=c.includes(this.observation.properties.tags,"type:report")?"type:report":c.includes(this.observation.properties.tags,"type:trailhead")?"type:trailhead":c.includes(this.observation.properties.tags,"type:sign")?"type:sign":"",this.observation.properties.organizationId?this.organizationId=this.observation.properties.organizationId+"":this.organizationId="-1"):(this.saving=!1,this.name="",this.description="",this.tags=[],this.images=[],this.observationLat=0,this.observationLng=0,this.observationType="")},sendCancelEvent:function(){this.$emit("cancel")},addTag:function(){var t=this.tag.toLowerCase().replace(/\s+/,"_").replace(/[\W]+/g,"");c.indexOf(this.tags,t)>-1?this.tag="":t&&(this.tags.push(t),this.tag="")},removeTag:function(t){this.tags=c.without(this.tags,t)},addImage:function(t){var e=this;if(confirm("This image ("+t.name+") will be added to the report immediately.  Continue?")){if(t.size<=this.maxImageSize){this.addingImage=!0,this.addingImageError="";var n=new FormData;return n.set("imageFile",t),l.a.post(this.$app_config.traildock_api_base_url+"rest/v2/image/attach/observation/"+this.observation.properties.id,n,{headers:{Authorization:"Bearer "+this.$store.state.user.token,"content-type":"multipart/form-data"}}).then(function(t){e.addingImage=!1,e.images.push(t.data),e.$emit("imgupdate",e.images)}).catch(function(t){c.has(t,"response.data.error")?e.addingImageError=t.response.data.error:e.addingImageError=t.message,e.addingImage=!1})}alert("Image file too large!")}},removeImage:function(image){var t=this;if(confirm("This image will be removed from the report immediately.  Continue?"))return this.removingImage=!0,l.a.delete(this.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+"/detach",{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(e){t.removingImage=!1,t.images=c.filter(t.images,function(img){return img.id!==image.id}),t.$emit("imgupdate",t.images)}).catch(function(e){c.has(e,"response.data.error")?t.removingImageError=e.response.data.error:t.removingImageError=e.message,t.removingImage=!1})},saveObservation:function(){var t=this;this.saving=!0,this.savingError="";var e={};return e.name=this.name,e.latitude=this.observationLat,e.longitude=this.observationLng,e.source="cbgtrails_web",this.organizationId?e.organizationId=this.organizationId:e.organizationId=-1,this.description&&(e.description=this.description),this.observedAt&&(e.observedAt=m()(this.observedAt).format()),e.tags=this.tags,l.a.put(this.$app_config.traildock_api_base_url+"rest/v2/observation/"+this.observation.properties.id,e,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(e){t.saving=!1,t.$emit("done",e.data)}).catch(function(e){t.saving=!1,c.has(e,"response.data.error")?t.savingError=e.response.data.error:t.savingError=e.message})}}},k=Object(C.a)(x,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.authenticated,expression:"authenticated"}]},[n("div",{staticClass:"field has-addons"},[t._m(0),t._v(" "),n("p",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationLat,expression:"observationLat"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.observationLat},on:{input:function(e){e.target.composing||(t.observationLat=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"field has-addons"},[t._m(1),t._v(" "),n("p",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationLng,expression:"observationLng"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.observationLng},on:{input:function(e){e.target.composing||(t.observationLng=e.target.value)}}})])]),t._v(" "),n("p",{staticClass:"help"},[t._v("\n      Click map to set latitude and longitude.\n    ")]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Report Date")]),t._v(" "),n("div",{staticClass:"control"},[n("flat-pickr",{staticClass:"input",attrs:{config:t.datePickerConfig},model:{value:t.observedAt,callback:function(e){t.observedAt=e},expression:"observedAt"}})],1)]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Title")]),t._v(" "),n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"input",class:{"is-danger":!t.name},attrs:{type:"text",placeholder:"Observation Title"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),t._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:!t.name,expression:"!name"}],staticClass:"help is-danger"},[t._v("\n        A title is required!\n      ")])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Description")]),t._v(" "),n("div",{staticClass:"control"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"textarea",attrs:{placeholder:"Observation Description"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Observation Type")]),t._v(" "),n("div",{staticClass:"control"},[n("label",{staticClass:"radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationType,expression:"observationType"}],attrs:{type:"radio",value:"type:report"},domProps:{checked:t._q(t.observationType,"type:report")},on:{change:function(e){t.observationType="type:report"}}}),t._v(" Trail Report")]),t._v(" "),n("label",{staticClass:"radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationType,expression:"observationType"}],attrs:{type:"radio",value:"type:trailhead"},domProps:{checked:t._q(t.observationType,"type:trailhead")},on:{change:function(e){t.observationType="type:trailhead"}}}),t._v(" Trailhead")]),t._v(" "),n("label",{staticClass:"radio"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.observationType,expression:"observationType"}],attrs:{type:"radio",value:"type:sign"},domProps:{checked:t._q(t.observationType,"type:sign")},on:{change:function(e){t.observationType="type:sign"}}}),t._v(" Trail Sign")])])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Tags")]),t._v(" "),n("div",{staticClass:"field has-addons"},[n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.tag,expression:"tag"}],staticClass:"input",attrs:{type:"text",placeholder:"Tag"},domProps:{value:t.tag},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag(e)},input:function(e){e.target.composing||(t.tag=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"control",on:{click:t.addTag}},[n("a",{staticClass:"button is-primary"},[t._v("\n            Add\n          ")])])])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.tags.length>0,expression:"tags.length > 0"}],staticClass:"columns"},[n("div",{staticClass:"column field is-grouped is-grouped-multiline"},t._l(t.tags,function(e,r){return n("div",{key:r,staticClass:"control"},[n("div",{staticClass:"tag is-info"},[t._v("\n            "+t._s(e)+"\n             "),n("button",{staticClass:"delete is-small",on:{click:function(n){return t.removeTag(e)}}})])])}),0)]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Images")]),t._v(" "),n("div",{staticClass:"control"},[n("dropzone",{attrs:{multiple:!0,message:'<a href="javascript:;" class="upload-link">Drop file here or click to select an image</a>',accept:"image/*"},on:{thumbnail:t.addImage}})],1),t._v(" "),n("p",{staticClass:"help"},[t._v("\n        5Mb max filesize\n      ")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.removingImage,expression:"removingImage"}],staticClass:"notification is-primary"},[t._v("\n      Removing image from report "),t._m(2)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.addingImage,expression:"addingImage"}],staticClass:"notification is-primary"},[t._v("\n      Adding image to report "),t._m(3)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.addingImageError,expression:"addingImageError"}],staticClass:"notification is-danger"},[n("button",{staticClass:"delete",on:{click:function(e){t.addingImageError=""}}}),t._v("\n      "+t._s(t.addingImageError)+"\n    ")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.removingImageError,expression:"removingImageError"}],staticClass:"notification is-danger"},[n("button",{staticClass:"delete",on:{click:function(e){t.removingImageError=""}}}),t._v("\n      "+t._s(t.removingImageError)+"\n    ")]),t._v(" "),n("div",{staticClass:"columns is-multiline"},t._l(t.images,function(image){return n("div",{key:image.id},[n("div",{staticClass:"column"},[n("figure",{staticClass:"image"},[n("img",{staticStyle:{width:"128px"},attrs:{src:image.url}})]),t._v(" "),n("button",{staticClass:"button is-small is-primary",on:{click:function(e){return t.removeImage(image)}}},[t._v("\n            Remove\n          ")])])])}),0),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.memberships.length>0,expression:"memberships.length > 0"}],staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Create in Organization")]),t._v(" "),n("div",{staticClass:"select"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.organizationId,expression:"organizationId"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.organizationId=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"-1"}},[t._v("\n            Traildock\n          ")]),t._v(" "),t._l(t.memberships,function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v("\n            "+t._s(e.name)+"\n          ")])})],2)])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.savingError,expression:"savingError"}],staticClass:"notification is-danger"},[t._v("\n      "+t._s(t.savingError)+"\n    ")]),t._v(" "),n("p",{directives:[{name:"show",rawName:"v-show",value:t.tag,expression:"tag"}],staticClass:"help is-danger"},[t._v("\n      You have an un-added tag.\n    ")]),t._v(" "),n("div",{staticClass:"field is-grouped"},[n("p",{staticClass:"control"},[n("button",{staticClass:"button is-primary",attrs:{disabled:!t.isValid||t.saving},on:{click:t.saveObservation}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.saving,expression:"!saving"}],staticClass:"icon"},[n("i",{staticClass:"fas fa-save"})]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.saving,expression:"saving"}],staticClass:"icon"},[n("i",{staticClass:"fas fa-spinner-third fa-spin"})]),t._v(" "),n("span",[t._v("Save")])])]),t._v(" "),n("p",{staticClass:"control"},[n("button",{staticClass:"button is-light",attrs:{disabled:t.saving},on:{click:t.sendCancelEvent}},[t._v("\n          Cancel\n        ")])])])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"control"},[e("a",{staticClass:"button is-static"},[this._v("\n          Latitude\n        ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"control"},[e("a",{staticClass:"button is-static"},[this._v("\n          Longitude\n        ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon"},[e("i",{staticClass:"fas fa-spinner-third fa-spin"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon"},[e("i",{staticClass:"fas fa-spinner-third fa-spin"})])}],!1,null,null,null).exports,O=n(367),A={name:"EmbedMapPage",components:{traildockMap:d.a,osmElement:O.a,createObservation:w,editObservation:k},props:{},data:function(){return{split:null,observations:[],observationsLoaded:!1,rememberLocation:!1,modalImageUrl:"",email:"",password:"",showLoginModal:!1,creatingObservation:!1,observationLat:null,observationLng:null,editingObservation:null,deletingObservation:null,deleteObservationWait:!1,deleteObservationError:""}},computed:{showObservationMarker:function(){return this.creatingObservation||this.editingObservation?{lat:this.observationLat,lng:this.observationLng}:null},authenticated:function(){return this.$store.getters["user/authenticated"]},showDocModal:function(){return this.$store.state.ideditor.selectedIds.length>0},registerUrl:function(){return c.has(this.$route,"query.org")?window.location.origin+"/register?org="+this.$route.query.org:window.location.origin+"/register"},loginWait:function(){return this.$store.state.user.loginWait},loginError:function(){return this.$store.state.user.loginError},apiUrl:function(){return this.$app_config.traildock_api_base_url},isProduction:function(){return this.$app_config.isProduction},sidebarStyle:function(){if(this.split){var t=!1;return this.$store.state.ideditor.selectedIds.length>0?t=!0:this.creatingObservation?t=!0:this.editingObservation&&(t=!0),t?(this.split.setSizes([75,25]),{padding:"20px"}):(this.split.collapse(1),null)}return null}},watch:{sidebarStyle:function(){var t=this;setTimeout(function(){t.$refs.map.resize()},500)}},mounted:function(){var t=this;if(this.debouncedUpdateObservations=c.debounce(function(){t.updateObservations()},1500),this.$route.params.ids){var e=this.$route.params.ids.split(",");this.$store.commit("ideditor/setSelectedIds",{selectedIds:e})}c.has(this.$route,"query.lat")||c.has(this.$route,"query.lng")||(this.rememberLocation=!0);var r=n(442),map=this.$refs.map,o=map.$el,l=this.$refs.sidebar;this.split=r.default([o,l],{sizes:[100,0],minSize:[300,300],direction:"horizontal",onDragEnd:function(){map.resize()}}),setTimeout(function(){map.resize()},500)},beforeDestroy:function(){this.split&&this.split.destroy()},methods:{cancelLogin:function(){this.password="",this.showLoginModal=!1},login:function(){var t=this,e=null;c.has(this.$route,"query.org")&&(e=this.$route.query.org),this.$store.dispatch("user/goLogin",{email:this.email,password:this.password,ensureOrganization:e}).then(function(){t.email="",t.password="",t.showLoginModal=!1})},onMapBoundsChange:function(){this.observationsLoaded?this.debouncedUpdateObservations():(this.observationsLoaded=!0,this.updateObservations());var map=this.$refs.map;map&&!this.editingObservation&&(this.observationLat=map.getCenter().lat,this.observationLng=map.getCenter().lng)},showImageModal:function(t){this.modalImageUrl=t},initDeleteObservation:function(t){this.deleteObservationError="",this.deletingObservation=t},finishDeleteObservation:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.deleteObservationWait=!0,t.prev=1,t.next=4,l.a.delete(this.$app_config.traildock_api_base_url+"rest/v2/observation/"+this.deletingObservation.properties.id,{headers:{Authorization:"Bearer "+this.$store.state.user.token}});case 4:this.deleteObservationWait=!1,this.observations=c.remove(this.observations,function(t){return t.properties.id!==e.deletingObservation.properties.id}),this.deletingObservation=null,t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),this.deleteObservationWait=!1,c.has(t.t0,"response.data.error")?this.deleteObservationError=t.t0.response.data.error:this.deleteObservationError=t.t0.message;case 13:case"end":return t.stop()}},t,this,[[1,9]])}));return function(){return t.apply(this,arguments)}}(),initEditObservation:function(t){this.observationLat=t.geometry.coordinates[1],this.observationLng=t.geometry.coordinates[0],this.editingObservation=t},initAddObservation:function(){var map=this.$refs.map;map&&(this.observationLat=map.getCenter().lat,this.observationLng=map.getCenter().lng),this.authenticated?this.creatingObservation=!0:this.showLoginModal=!0},onCancelObservation:function(){this.creatingObservation=!1},onCancelEditObservation:function(){this.editingObservation=null},onCreatedObservation:function(t){var e={geometry:t.geometry,properties:c.omit(t,["geometry"])};this.observations.push(e),this.creatingObservation=!1},onEditedObservation:function(t){var e={geometry:t.geometry,properties:c.omit(t,["geometry"]),_forceMapUpdate:!0};this.observations=c.remove(this.observations,function(e){return e.properties.id!==t.id}),this.observations.push(e),this.editingObservation=null},onObservationForceReRendered:function(t){var e=this,n=!0,r=!1,o=void 0;try{for(var l,d=function(){var t=l.value,n=c.find(e.observations,function(e){return e.properties.id===t});n&&(n._forceMapUpdate=!1)},v=t[Symbol.iterator]();!(n=(l=v.next()).done);n=!0)d()}catch(t){r=!0,o=t}finally{try{n||null==v.return||v.return()}finally{if(r)throw o}}},onEditedObservationImageUpdate:function(t){var e=this;this.editingObservation&&(this.editingObservation.properties.images=t,this.editingObservation._forceMapUpdate=!0,this.observations=c.remove(this.observations,function(t){return t.properties.id!==e.editingObservation.properties.id}),this.observations.push(this.editingObservation))},onMoveObservationMarker:function(t){this.observationLng=t.lng,this.observationLat=t.lat},updateObservations:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var map,e,n,r,o,d,v,m,h,f,_,C,w,y,x=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(map=this.$refs.map)){t.next=33;break}return e=map.bounds(),n=e.getNorthEast().lat,r=e.getNorthEast().lng,o=e.getSouthWest().lat,d=e.getSouthWest().lng,t.next=9,l.a.get(this.$app_config.traildock_api_base_url+"rest/v2/observation/within/"+n+"/"+r+"/"+o+"/"+d+"?format=geojson");case 9:if(v=t.sent,m=[],!v.data){t.next=32;break}for(h=!0,f=!1,_=void 0,t.prev=15,C=function(){var t=y.value;console.log(),c.find(x.observations,function(e){return e.properties.id===t.properties.id})||m.push(t)},w=v.data.features[Symbol.iterator]();!(h=(y=w.next()).done);h=!0)C();t.next=24;break;case 20:t.prev=20,t.t0=t.catch(15),f=!0,_=t.t0;case 24:t.prev=24,t.prev=25,h||null==w.return||w.return();case 27:if(t.prev=27,!f){t.next=30;break}throw _;case 30:return t.finish(27);case 31:return t.finish(24);case 32:this.observations.length>1e4?this.observations=m:this.observations=m?c.concat(this.observations,m):[];case 33:case"end":return t.stop()}},t,this,[[15,20,24,32],[25,,27,31]])}));return function(){return t.apply(this,arguments)}}(),centerMap:function(t){var map=this.$refs.map;map?map.center(t):parent.postMessage("center:"+JSON.stringify(t),"*")}}},I=(n(443),Object(C.a)(A,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"section splitFlex",staticStyle:{padding:"0px"}},[n("traildock-map",{ref:"map",staticClass:"splitFlexCol",class:{spaceBottom:!t.$store.state.ideditor.isEmbedded},attrs:{id:"map",observations:t.observations,"start-location":t.$route.query,"remember-location":t.rememberLocation,"show-observation-marker":t.showObservationMarker},on:{"show-observation-image":t.showImageModal,"delete-observation":t.initDeleteObservation,"edit-observation":t.initEditObservation,newbounds:t.onMapBoundsChange,"observation-marker-move":t.onMoveObservationMarker,"marker-forced":t.onObservationForceReRendered}}),t._v(" "),n("div",{ref:"sidebar",staticClass:"splitFlexCol embedMapSidebar",style:t.sidebarStyle},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.sidebarStyle,expression:"sidebarStyle"}],staticStyle:{"margin-bottom":"10px"}},[n("div",[n("a",{attrs:{href:t.apiUrl+"rest/docs",target:"_blank"}},[t.isProduction?t._e():n("span",{staticClass:"tag is-danger"},[t._v(t._s(t.apiUrl.replace("https://","").replace("/","")))])])]),t._v(" "),n("div",[n("a",{attrs:{href:t.apiUrl+"rest/docs",target:"_blank"}},[t.isProduction?n("span",{staticClass:"tag is-success"},[t._v(t._s(t.apiUrl.replace("https://","").replace("/","")))]):t._e()])])]),t._v(" "),t.creatingObservation?n("div",[n("create-observation",{attrs:{lat:t.observationLat,lng:t.observationLng},on:{cancel:t.onCancelObservation,done:t.onCreatedObservation}})],1):t.editingObservation?n("div",[n("edit-observation",{attrs:{lat:t.observationLat,lng:t.observationLng,observation:t.editingObservation},on:{cancel:t.onCancelEditObservation,done:t.onEditedObservation,imgupdate:t.onEditedObservationImageUpdate}})],1):n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:0===t.$store.state.ideditor.selectedIds.length,expression:"$store.state.ideditor.selectedIds.length === 0"}],staticStyle:{padding:"20px"}},[t._v("\n        Please select an "),n("a",{attrs:{href:"https://wiki.openstreetmap.org/wiki/Elements",target:"_blank"}},[t._v("OpenStreetMap element")]),t._v(" in the map.\n      ")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.authenticated&&t.$store.state.ideditor.selectedIds.length>0,expression:"!authenticated && $store.state.ideditor.selectedIds.length > 0"}],staticStyle:{"margin-bottom":"20px"},attrs:{v:""}},[n("button",{staticClass:"button is-info",on:{click:function(e){t.showLoginModal=!0}}},[t._v("\n          Login to manage map data\n        ")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.ideditor.selectedIds.length>0,expression:"$store.state.ideditor.selectedIds.length > 0"}]},t._l(t.$store.state.ideditor.selectedIds,function(e){return n("osm-element",{key:e,attrs:{"element-id":e},on:{center:t.centerMap}})}),1)])]),t._v(" "),n("div",{staticClass:"modal",class:{"is-active":t.modalImageUrl}},[n("div",{staticClass:"modal-background"}),t._v(" "),n("div",{staticClass:"modal-content"},[n("p",{staticClass:"image is-4by3"},[n("img",{attrs:{src:t.modalImageUrl,alt:""}})])]),t._v(" "),n("button",{staticClass:"modal-close is-large is-primary",attrs:{"aria-label":"close"},on:{click:function(e){t.modalImageUrl=null}}})]),t._v(" "),n("div",{staticClass:"modal",class:{"is-active":t.showLoginModal}},[n("div",{staticClass:"modal-background"}),t._v(" "),n("div",{staticClass:"modal-card"},[n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[t._v("\n          Login to Traildock\n        ")]),t._v(" "),n("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:t.cancelLogin}})]),t._v(" "),n("section",{staticClass:"modal-card-body"},[n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Email")]),t._v(" "),n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],staticClass:"input",attrs:{type:"email"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Password")]),t._v(" "),n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"input",attrs:{type:"password"},domProps:{value:t.password},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.login(e)},input:function(e){e.target.composing||(t.password=e.target.value)}}})])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.loginError,expression:"loginError"}],staticClass:"notification is-danger"},[t._v("\n          "+t._s(t.loginError)+"\n        ")])]),t._v(" "),n("footer",{staticClass:"modal-card-foot"},[n("button",{staticClass:"button is-link is-primary",attrs:{disabled:!t.email||!t.password},on:{click:t.login}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.loginWait,expression:"!loginWait"}],staticClass:"icon"},[n("i",{staticClass:"far fa-sign-in"})]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.loginWait,expression:"loginWait"}],staticClass:"icon"},[n("i",{staticClass:"fas fa-spinner-third fa-spin"})]),t._v(" "),n("span",[t._v("Login")])]),t._v(" "),n("button",{staticClass:"button",on:{click:t.cancelLogin}},[t._v("\n          Cancel\n        ")]),t._v(" "),n("a",{staticClass:"button is-text",attrs:{href:t.registerUrl,target:"_blank"}},[t._v("\n          Need to register?\n        ")])])])]),t._v(" "),n("div",{staticClass:"modal",class:{"is-active":t.deletingObservation}},[n("div",{staticClass:"modal-background"}),t._v(" "),n("div",{staticClass:"modal-card"},[n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[t._v("\n          Delete Observation\n        ")]),t._v(" "),n("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(e){t.deletingObservation=null}}})]),t._v(" "),n("section",{staticClass:"modal-card-body"},[n("p",[t._v("Really remove this observation?")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.deleteObservationError,expression:"deleteObservationError"}],staticClass:"notification is-danger",staticStyle:{"margin-top":"10px"}},[t._v("\n          "+t._s(t.deleteObservationError)+"\n        ")])]),t._v(" "),n("footer",{staticClass:"modal-card-foot"},[n("button",{staticClass:"button is-danger",on:{click:t.finishDeleteObservation}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.deleteObservationWait,expression:"!deleteObservationWait"}],staticClass:"icon"},[n("i",{staticClass:"far fa-times"})]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.deleteObservationWait,expression:"deleteObservationWait"}],staticClass:"icon"},[n("i",{staticClass:"fas fa-spinner-third fa-spin"})]),t._v(" "),n("span",[t._v("Delete")])]),t._v(" "),n("button",{staticClass:"button",on:{click:function(e){t.deletingObservation=null}}},[t._v("\n          Cancel\n        ")])])])]),t._v(" "),n("div",{staticClass:"actions",staticStyle:{position:"absolute",bottom:"10px",left:"10px"}},[n("button",{staticClass:"button",on:{click:t.initAddObservation}},[t._m(0),t._v(" "),n("span",[t._v("Add Observation")])])])],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon"},[e("i",{staticClass:"fas fa-plus"})])}],!1,null,null,null));e.default=I.exports}}]);