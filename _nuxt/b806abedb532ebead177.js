(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{190:function(e,t,r){"use strict";var n=r(195).default;(n=r(199)).autoDiscover=!1,r(200);var o={name:"Dropzone",props:{multiple:{type:Boolean,default:!1},accept:{type:String,default:null},message:{type:String,default:"Drop file here or click to upload"}},data:function(){return{}},mounted:function(){var e=this;this.dropzone=new n(this.$el,{autoProcessQueue:!1,url:"#",acceptedFiles:this.accept,uploadMultiple:this.multiple,dictDefaultMessage:this.message,addedfile:function(t){e.$emit("drop",t)},thumbnail:function(t){e.$emit("thumbnail",t)}})},beforeDestroy:function(){this.dropzone&&this.dropzone.destroy()}},l=r(17),component=Object(l.a)(o,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"dropzone dropzone-component"})},[],!1,null,null,null);t.a=component.exports},195:function(e,t,r){"use strict";r.r(t);var n={name:"Loading"},o=r(17),component=Object(o.a)(n,function(){var e=this.$createElement;return(this._self._c||e)("div",[this._v("\n  Loading...\n")])},[],!1,null,null,null);t.default=component.exports},198:function(e,t,r){var content=r(379);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(53).default)("6e2a5079",content,!0,{sourceMap:!1})},370:function(e,t,r){"use strict";r(36);var n=r(7),o=(r(211),r(2)),l=r(3),c=r.n(l),d=r(185),m=r.n(d),h=(r(383),r(0).default.component("jsoneditor-loading",{data:function(){return{}},template:"<div>Loading...</div>"}));h=r(387);var v={name:"DocEditor",props:{data:{type:Object,default:function(){return{}}},ro:{type:Boolean,default:!0}},data:function(){return{editor:null}},mounted:function(){var e=this;this.editor=new h(this.$el,{onChange:function(){e.editor&&e.$emit("change",e.editor.get())},onEditable:function(){return!e.ro}}),this.editor.set(this.data)},beforeDestroy:function(){this.editor&&(this.editor.destroy(),this.editor=null)}},f=r(17),y={name:"Doc",components:{docEditor:Object(f.a)(v,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"jsoneditor",staticStyle:{height:"200px"}})},[],!1,null,"19275aac",null).exports},props:{doc:{type:Object,required:!0},organization:{type:Object,required:!1,default:null}},data:function(){return{user:null,newValue:null,saving:!1,savingError:"",deleting:!1,deletingError:"",deleted:!1}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{doc:function(){this.loadUser()}},methods:{loadUser:function(){var e=this,t=this.$app_config.traildock_api_base_url+"rest/v2/user/"+this.doc.userId;c.a.get(t).then(function(t){e.user=t.data}).catch(function(){e.user=null})},onChangeValue:function(e){this.newValue=e},onDelete:function(){var e=this;if(confirm("Really delete this doc?")){this.deleting=!0,this.deletingError="";var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key;this.organization&&this.organization.id&&(t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key+"/organization/"+this.organization.id),c.a.delete(t,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(t){e.deleting=!1,e.deleted=!0}).catch(function(t){e.deleting=!1,o.has(t,"response.data.error")?e.deletingError=t.response.data.error:e.deletingError=t.message})}},onSave:function(){var e=this;this.saving=!0,this.savingError="";var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key;this.organization&&this.organization.id&&(t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.doc.docableType+"/"+this.doc.docableId+"/"+this.doc.key+"/organization/"+this.organization.id),c.a.put(t,this.newValue,{headers:{Authorization:"Bearer "+this.$store.state.user.token}}).then(function(t){e.saving=!1,e.newValue=null,e.$emit("save",t.data)}).catch(function(t){e.saving=!1,o.has(t,"response.data.error")?e.savingError=t.response.data.error:e.savingError=t.message})},formatDate:function(text){return m()(text).format("dddd, MMMM Do YYYY, h:mm:ss a")},mounted:function(){this.loadUser()}}},w={name:"OrganizationElementDocs",components:{doc:Object(f.a)(y,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:!e.deleted,expression:"!deleted"}]},[r("span",{staticClass:"tag is-dark"},[e._v(e._s(e.doc.key))]),e._v(" "),r("small",[e.doc.updatedAt?r("span",[e._v("saved "+e._s(e.formatDate(e.doc.updatedAt)))]):e._e(),e._v(" "),e.user?r("span",[e._v("by "+e._s(e.user.displayName))]):e._e(),e._v(" "),r("doc-editor",{attrs:{ro:!e.authenticated,data:e.doc.value},on:{change:e.onChangeValue}})],1),e._v(" "),e.authenticated?r("div",{staticClass:"field has-addons"},[r("p",{staticClass:"control"},[r("button",{staticClass:"button is-primary",attrs:{disabled:(e.saving||!e.newValue)&&e.doc.id},on:{click:e.onSave}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.saving,expression:"!saving"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-save"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.saving,expression:"saving"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Save")])])]),e._v(" "),r("p",{staticClass:"control"},[r("button",{staticClass:"button is-danger",attrs:{disabled:e.deleting||!e.doc.id},on:{click:e.onDelete}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.deleting,expression:"!deleting"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-trash"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.deleting,expression:"deleting"}],staticClass:"icon"},[r("i",{staticClass:"fa-fw fas fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Delete")])])])]):e._e(),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.savingError,expression:"savingError"}],staticClass:"notification is-danger"},[e._v("\n    "+e._s(e.savingError)+"\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.deletingError,expression:"deletingError"}],staticClass:"notification is-danger"},[e._v("\n    "+e._s(e.deletingError)+"\n  ")])])},[],!1,null,"357a5e8e",null).exports},props:{organization:{type:Object,required:!0},elementId:{type:String,required:!0},elementType:{type:String,required:!0}},data:function(){return{docs:[],loadingDocsError:"",loadingDocs:!1,showNewDocModal:!1,newDocKey:"",newDocError:""}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]}},watch:{elementId:function(){this.loadDocs()}},mounted:function(){this.loadDocs()},methods:{loadDocs:function(){var e=this;this.loadingDocs=!0,this.loadingDocsError="",this.docs=[];var t=this.$app_config.traildock_api_base_url+"rest/v2/doc/"+this.elementType+"/"+this.elementId;this.organization.id&&(t=t+"/organization/"+this.organization.id),c.a.get(t).then(function(t){e.docs=t.data,e.loadingDocs=!1}).catch(function(t){var r="";r=o.has(t,"response.data.error")?t.response.data.error:t.message,e.docs=[],e.loadingDocsError=r,e.loadingDocs=!1})},onDocSave:function(e,t){e.value=t.value,e.updatedAt=t.updatedAt,e.createdAt=t.createdAt,e.userId=t.userId,e.key=t.key,e.images=t.images,e.organizationId=t.organizationId,e.id=t.id,e.isNew=!1},onCreateNewDoc:function(){this.newDocError="";var e={};e[this.newDocKey]="",this.docs.push({docableId:this.elementId,docableType:this.elementType,key:this.newDocKey,value:e}),this.newDocKey="",this.showNewDocModal=!1}}},_=Object(f.a)(w,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("nav",{staticClass:"level"},[r("div",{staticClass:"level-left"},[e.organization.logoImageUrl?r("div",{staticClass:"level-item"},[r("figure",{staticClass:"image is-24x24"},[r("img",{attrs:{src:e.organization.logoImageUrl}})])]):e._e(),e._v(" "),r("div",{staticClass:"level-item"},[r("strong",{directives:[{name:"show",rawName:"v-show",value:e.organization.name,expression:"organization.name"}]},[e._v(e._s(e.organization.name))])])])]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.loadingDocs,expression:"loadingDocs"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-spinner-third fa-spin"})]),e._v(" "),e._l(e.docs,function(t){return r("doc",{key:t.id,staticStyle:{"margin-bottom":"10px"},attrs:{doc:t,organization:e.organization},on:{save:function(r){return e.onDocSave(t,r)}}})}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.docs.length,expression:"docs.length === 0"}]},[e._v("\n    No docs found for this element.\n  ")]),e._v(" "),e.authenticated?r("div",{staticStyle:{"margin-top":"20px"}},[r("button",{staticClass:"button is-info",attrs:{disabled:!e.authenticated},on:{click:function(t){e.showNewDocModal=!0}}},[e._m(0),e._v(" "),r("span",[e._v("Add New Doc")])])]):e._e(),e._v(" "),r("div",{staticClass:"modal",class:{"is-active":e.showNewDocModal}},[r("div",{staticClass:"modal-background"}),e._v(" "),r("div",{staticClass:"modal-card"},[r("header",{staticClass:"modal-card-head"},[r("p",{staticClass:"modal-card-title"},[e._v("\n          Create New Doc\n        ")]),e._v(" "),r("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){e.showNewDocModal=!1}}})]),e._v(" "),r("section",{staticClass:"modal-card-body"},[r("div",{staticClass:"field"},[r("label",{staticClass:"label"},[e._v("Doc Key")]),e._v(" "),r("div",{staticClass:"control"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.newDocKey,expression:"newDocKey"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.newDocKey},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onCreateNewDoc(t)},input:function(t){t.target.composing||(e.newDocKey=t.target.value)}}})])])]),e._v(" "),r("footer",{staticClass:"modal-card-foot"},[r("button",{staticClass:"button is-success",on:{click:e.onCreateNewDoc}},[e._m(1),e._v(" "),r("span",[e._v("Create")])]),e._v(" "),r("button",{staticClass:"button is-primary",on:{click:function(t){e.showNewDocModal=!1}}},[e._v("\n          Cancel\n        ")])])])])],2)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa-fw fas fa-plus"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-plus"})])}],!1,null,"b97128cc",null).exports,j={name:"OSMElementImages",components:{dropzone:r(190).a},props:{elementId:{type:String,required:!0},elementType:{type:String,required:!0}},data:function(){return{loadingImages:!1,loadingImagesError:"",images:[],maxImageSize:5e6,removingImage:!1,removingImageError:"",addingImage:!1,addingImageError:""}},computed:{authenticated:function(){return this.$store.getters["user/authenticated"]},me:function(){return this.$store.state.user.me}},watch:{elementId:function(){this.loadImages()}},mounted:function(){this.loadImages()},methods:{loadImages:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingImages=!0,e.prev=1,e.next=4,c.a.get(this.$app_config.traildock_api_base_url+"rest/v2/images/"+this.elementType+"/"+this.elementId);case 4:t=e.sent,this.images=t.data,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),this.loadingImages=!1,o.has(e.t0,"response.data.error")?this.loadingImagesError=e.t0.response.data.error:this.loadingImagesError=e.t0.message;case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}(),addImage:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.size<=this.maxImageSize)){e.next=19;break}return this.addingImage=!0,this.addingImageError="",(r=new FormData).set("imageFile",t),e.prev=5,e.next=8,c.a.post(this.$app_config.traildock_api_base_url+"rest/v2/image/attach/"+this.elementType+"/"+this.elementId,r,{headers:{Authorization:"Bearer "+this.$store.state.user.token,"content-type":"multipart/form-data"}});case 8:n=e.sent,this.addingImage=!1,this.images.push(n.data),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),o.has(e.t0,"response.data.error")?this.addingImageError=e.t0.response.data.error:this.addingImageError=e.t0.message,this.addingImage=!1;case 17:e.next=20;break;case 19:alert("Image file too large!");case 20:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}(),removeImage:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(image){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("This image will be removed from the element.  Continue?")){e.next=13;break}return this.removingImage=!0,e.prev=2,e.next=5,c.a.delete(this.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+"/detach",{headers:{Authorization:"Bearer "+this.$store.state.user.token}});case 5:this.removingImage=!1,this.images=o.filter(this.images,function(img){return img.id!==image.id}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),o.has(e.t0,"response.data.error")?this.removingImageError=e.t0.response.data.error:this.removingImageError=e.t0.message,this.removingImage=!1;case 13:case"end":return e.stop()}},e,this,[[2,9]])}));return function(t){return e.apply(this,arguments)}}(),formattedDocDate:function(e){return m()(e).format("dddd, MMMM Do YYYY, h:mm a")},showImageInModal:function(image){this.$emit("image",image.url)}}},k={name:"OSMElement",components:{organization:_,images:Object(f.a)(j,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",{staticClass:"title is-5"},[e._v("\n    Images\n  ")]),e._v(" "),e._l(e.images,function(image){return r("article",{key:image.id,staticClass:"media"},[r("figure",{staticClass:"media-left"},[r("p",{staticClass:"image is-128x128"},[r("a",{on:{click:function(t){return t.preventDefault(),e.showImageInModal(image)}}},[r("img",{staticStyle:{width:"128px"},attrs:{src:image.url}})])])]),e._v(" "),r("div",{staticClass:"media-content"},[r("div",{staticClass:"content"},[r("p",[image.user?r("span",[e._v("by ")]):e._e(),image.user?r("strong",[e._v(e._s(image.user.displayName))]):e._e(),e._v(" "),r("small",[e._v(e._s(e.formattedDocDate(image.createdAt)))])])]),e._v(" "),r("nav",{staticClass:"level is-mobile"},[r("div",{staticClass:"level-left"},[r("a",{on:{click:function(t){return t.preventDefault(),e.showImageInModal(image)}}},[e._m(0,!0)])])])]),e._v(" "),r("div",{staticClass:"media-right"},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.authenticated&&e.me&&image.user&&e.me.id===image.user.id,expression:"authenticated && me && image.user && me.id === image.user.id"}],staticClass:"delete",on:{click:function(t){return e.removeImage(image)}}})])])}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.images.length,expression:"images.length === 0"}]},[e._v("\n    No images have been attached to this element.\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.authenticated,expression:"authenticated"}],staticClass:"field"},[r("div",{staticClass:"control"},[r("dropzone",{attrs:{multiple:!0,message:'<a href="javascript:;" class="upload-link">Drop file here or click to select an image</a>',accept:"image/*"},on:{thumbnail:e.addImage}})],1),e._v(" "),r("p",{staticClass:"help"},[e._v("\n      5Mb max filesize\n    ")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.removingImage,expression:"removingImage"}],staticClass:"notification is-primary"},[e._v("\n    Removing image from element "),e._m(1)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.addingImage,expression:"addingImage"}],staticClass:"notification is-primary"},[e._v("\n    Adding image to element "),e._m(2)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.addingImageError,expression:"addingImageError"}],staticClass:"notification is-danger"},[r("button",{staticClass:"delete",on:{click:function(t){e.addingImageError=""}}}),e._v("\n    "+e._s(e.addingImageError)+"\n  ")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.removingImageError,expression:"removingImageError"}],staticClass:"notification is-danger"},[r("button",{staticClass:"delete",on:{click:function(t){e.removingImageError=""}}}),e._v("\n    "+e._s(e.removingImageError)+"\n  ")])],2)},[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon is-small"},[t("i",{staticClass:"fas fa-expand"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-spinner-third fa-spin"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-spinner-third fa-spin"})])}],!1,null,"5ba5fb99",null).exports},props:{elementId:{type:String,required:!0}},data:function(){return{elementName:"",modalImageUrl:"",centerWait:!1,centerNodeId:"",osmTags:[],memberships:[]}},computed:{elementType:function(){if(this.elementId&&this.elementId.length>0)switch(this.elementId[0]){case"w":return"way";case"n":return"node";default:return"relation"}return""},elementRawId:function(){return o.trimStart(this.elementId,"wnr")}},watch:{elementId:function(){this.loadElementInfo()},"$store.state.user.me":function(){this.loadMemberships()}},mounted:function(){this.loadElementInfo(),this.loadMemberships()},methods:{sendCenterEvent:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r,n,o,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.centerWait=!0,e.prev=1,e.next=4,c.a.get("https://api.openstreetmap.org/api/0.6/node/"+this.centerNodeId);case 4:t=e.sent,r=new DOMParser,n=r.parseFromString(t.data,"text/xml"),(o=n.getElementsByTagName("node"))&&o.length>0&&(l=o[0].getAttribute("lat"),d=o[0].getAttribute("lon"),l&&d&&this.$emit("center",{lat:l,lng:d})),this.centerWait=!1,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.centerWait=!1;case 15:case"end":return e.stop()}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}(),loadElementInfo:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(){var t,r,n,o,i,l,d,m,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.elementType){e.next=11;break}return e.next=3,c.a.get("https://api.openstreetmap.org/api/0.6/"+this.elementType+"/"+this.elementRawId);case 3:for(t=e.sent,this.elementName="",r=new DOMParser,n=r.parseFromString(t.data,"text/xml"),o=n.getElementsByTagName("tag"),i=0;i<o.length;i++)"name"===(l=o[i]).getAttribute("k")&&(d=l.getAttribute("v"))&&(this.elementName=d),this.osmTags.push({key:l.getAttribute("k"),value:l.getAttribute("v")});(m=n.getElementsByTagName("nd"))&&m.length>0&&(h=m[0].getAttribute("ref"))&&(this.centerNodeId=h);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),loadMemberships:function(){var e=this;this.memberships=[],this.$store.state.user.me&&this.$store.dispatch("user/goFetchMemberships",{}).then(function(t){e.memberships=t})},showImageModal:function(e){e&&(this.modalImageUrl=e)}}},x=Object(f.a)(k,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.elementType,expression:"elementType"}]},[r("div",{},[r("div",{},[r("h1",{staticClass:"title is-3"},[e._v("\n        "+e._s(e.elementName)+"\n      ")]),e._v(" "),r("h2",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.elementType)+" "+e._s(e.elementRawId)+"\n      ")])]),e._v(" "),r("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[r("button",{directives:[{name:"show",rawName:"v-show",value:e.centerNodeId,expression:"centerNodeId"}],staticClass:"button is-small",on:{click:e.sendCenterEvent}},[r("span",{directives:[{name:"show",rawName:"v-show",value:!e.centerWait,expression:"!centerWait"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-fw fa-location"})]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.centerWait,expression:"centerWait"}],staticClass:"icon"},[r("i",{staticClass:"fas fa-fw fa-spinner-third fa-spin"})]),e._v(" "),r("span",[e._v("Center In Map")])])])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.osmTags.length>0&&!e.$store.state.ideditor.isEmbedded,expression:"osmTags.length > 0 && !$store.state.ideditor.isEmbedded"}],staticClass:"field is-grouped is-grouped-multiline"},e._l(e.osmTags,function(t){return r("div",{key:t.key,staticClass:"control"},[r("div",{staticClass:"tag",class:{"is-success":"yes"===t.value||"designated"===t.value,"is-danger":"no"===t.value}},[e._v("\n        "+e._s(t.key)+" : "+e._s(t.value)+"\n      ")])])}),0),e._v(" "),r("organization",{staticStyle:{"margin-bottom":"20px"},attrs:{organization:{name:"",id:null},"element-type":e.elementType,"element-id":e.elementRawId}}),e._v(" "),e._l(e.memberships,function(t){return r("div",{key:t.id,staticClass:"box"},[r("organization",{attrs:{organization:t,"element-type":e.elementType,"element-id":e.elementRawId}})],1)}),e._v(" "),r("images",{attrs:{"element-type":e.elementType,"element-id":e.elementRawId},on:{image:e.showImageModal}}),e._v(" "),r("hr"),e._v(" "),r("div",{staticClass:"modal",class:{"is-active":e.modalImageUrl}},[r("div",{staticClass:"modal-background"}),e._v(" "),r("div",{staticClass:"modal-content"},[r("p",{staticClass:"image is-4by3"},[r("img",{attrs:{src:e.modalImageUrl,alt:""}})])]),e._v(" "),r("button",{staticClass:"modal-close is-large is-primary",attrs:{"aria-label":"close"},on:{click:function(t){e.modalImageUrl=null}}})])],2)},[],!1,null,"3dab304a",null);t.a=x.exports},371:function(e,t,r){"use strict";r(37),r(36);var n=r(7),o=(r(211),r(107),r(56),r(376),r(74),r(210),r(54),r(55),r(20),r(16),r(2)),l=r(377),c=r.n(l),d={"all_trails-04-28-8yvqeu":"mapbox://traildock-d.ad7igrv6","CO_all_trails-06-17-ah1o4v":"mapbox://traildock-d.cffx5ks1",ustrails14:"composite"},m=o.keys(d),h={name:"TraildockMap",props:{startLocation:{type:Object,required:null,default:function(){return{}}},showObservationMarker:{type:Object,required:null,default:function(){return{}}},rememberLocation:{type:Boolean,default:!0},rememberLocationKey:{type:String,default:"traildock_map"},observations:{type:Array,default:function(){return[]}}},data:function(){return{map:null,mapLat:0,mapLng:0,mapZoom:0,selectedLayers:[],highlightLayerAdded:!1,observationMarker:null,observationMarkers:[],startingMapLat:localStorage.getItem(this.rememberLocationKey+":mapLat")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapLat")||"38.870010"):38.87001,startingMapLng:localStorage.getItem(this.rememberLocationKey+":mapLng")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapLng")||"-106.980974"):-106.980974,startingMapZoom:localStorage.getItem(this.rememberLocationKey+":mapZoom")?parseFloat(localStorage.getItem(this.rememberLocationKey+":mapZoom")||"12"):12}},computed:{me:function(){return this.$store.state.user.me}},watch:{mapLat:function(){this.mapLat&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapLat",this.mapLat+"")},mapLng:function(){this.mapLng&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapLng",this.mapLng+"")},mapZoom:function(){this.mapZoom&&this.rememberLocation&&localStorage.setItem(this.rememberLocationKey+":mapZoom",this.mapZoom+"")},showObservationMarker:function(){if(this.map)if(o.isEmpty(this.showObservationMarker))this.observationMarker&&this.observationMarker.remove();else{if(!this.observationMarker){var e=c.a.parseHTML('<div class="observationMarker new" style="text-align: center;"><i style="font-size: 36px; color: #FF0000;" class="far fa-map-marker-alt"></i></div>');this.observationMarker=new mapboxgl.Marker(e[0]).setOffset([0,-18]).setLngLat(new mapboxgl.LngLat(this.showObservationMarker.lng,this.showObservationMarker.lat))}this.observationMarker.setLngLat(new mapboxgl.LngLat(this.showObservationMarker.lng,this.showObservationMarker.lat)),this.observationMarker.addTo(this.map)}},observations:function(){var e=this,t=[],r=[],n=[],l=!0,c=!1,d=void 0;try{for(var m,h=function(){var r=m.value;o.find(e.observationMarkers,function(e){return e._observation.properties.id===r.properties.id})||t.push(r),r._forceMapUpdate&&(n.push(r.properties.id),t.push(r))},v=this.observations[Symbol.iterator]();!(l=(m=v.next()).done);l=!0)h()}catch(e){c=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw d}}var f=!0,y=!1,w=void 0;try{for(var _,j=function(){var marker=_.value,t=marker;o.find(e.observations,function(e){return e.properties.id===t._observation.properties.id})||r.push(marker),o.indexOf(n,t._observation.properties.id)>=0&&r.push(marker)},k=this.observationMarkers[Symbol.iterator]();!(f=(_=k.next()).done);f=!0)j()}catch(e){y=!0,w=e}finally{try{f||null==k.return||k.return()}finally{if(y)throw w}}for(var x=0,C=r;x<C.length;x++){C[x].remove()}for(var I=0,L=t;I<L.length;I++){var z=L[I];this.addObservation(z)}n&&this.$emit("marker-forced",n)}},mounted:function(){this.loadMap()},beforeDestroy:function(){this.map&&this.map.remove()},methods:{highlightSelectedLayers:function(){if(this.map.isStyleLoaded()&&!this.highlightLayerAdded&&(this.highlightLayerAdded=!0,this.map.addSource("highlight",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"highlight",type:"line",source:"highlight",paint:{"line-color":"yellow","line-opacity":.75,"line-width":8}})),this.highlightLayerAdded){var source=this.map.getSource("highlight");source&&source.setData({type:"FeatureCollection",features:[]});var e=[],t=!0,r=!1,n=void 0;try{for(var o,l=this.selectedLayers[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var c=o.value,d=this.map.querySourceFeatures(c.source,{sourceLayer:c.sourceLayer,filter:[c.filterOp,c.filterField,c.filterCompare]}),m=!0,h=!1,v=void 0;try{for(var f,y=d[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var w=f.value;e.push(w.toJSON())}}catch(e){h=!0,v=e}finally{try{m||null==y.return||y.return()}finally{if(h)throw v}}}}catch(e){r=!0,n=e}finally{try{t||null==l.return||l.return()}finally{if(r)throw n}}if(this.highlightLayerAdded&&e)if(e.length>1){var _={type:"FeatureCollection",features:e};source.setData(_)}else 1===e.length&&source.setData(e[0])}},loadMap:function(){var e=this,t=this.startingMapLat,r=this.startingMapLng,n=this.startingMapZoom;this.startLocation&&(o.has(this.startLocation,"lat")&&(t=this.startLocation.lat),o.has(this.startLocation,"lng")&&(r=this.startLocation.lng),o.has(this.startLocation,"zoom")&&(n=this.startLocation.zoom)),o.set(mapboxgl,"accessToken",this.$app_config.mapbox_access_token),this.map=new mapboxgl.Map({container:this.$el,style:this.$app_config.mapbox_base_style,center:new mapboxgl.LngLat(r,t),zoom:n,logoPosition:"top-left"}),this.map&&(this.map.addControl(new mapboxgl.NavigationControl),this.map.on("load",function(){setTimeout(function(){e.highlightRouteIds()},500),e.map.on("moveend",function(t){var r=e.map.getBounds().getCenter();e.mapLat=r.lat,e.mapLng=r.lng,e.highlightSelectedLayers(),e.$emit("newbounds")}),e.map.on("zoomend",function(t){e.mapZoom=e.map.getZoom(),e.highlightSelectedLayers(),e.$emit("newbounds")}),e.$emit("newbounds")}),this.map.on("mousemove",function(t){var r=e.map.queryRenderedFeatures(t.point),n=!1,l=!0,c=!1,d=void 0;try{for(var h,v=r[Symbol.iterator]();!(l=(h=v.next()).done);l=!0){var f=h.value,y=f.layer["source-layer"];o.indexOf(m,y)>=0?n=!0:f.id&&(f.id+"").length>1&&(n=!0)}}catch(e){c=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw d}}e.map.getCanvas().style.cursor=n?"pointer":""}),this.map.on("click",function(t){if(o.isEmpty(e.showObservationMarker)){e.selectedLayers=[];var r=[[t.point.x-5,t.point.y-5],[t.point.x+5,t.point.y+5]],n=e.map.queryRenderedFeatures(r),l=[],c=!0,d=!1,h=void 0;try{for(var v,f=n[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var y=v.value,w=null,_=y.layer["source-layer"];if(o.indexOf(m,_)>=0){if(y.properties&&(w=y.properties.id.replace("way/","w"))&&o.indexOf(l,w)<0){l.push(w);var j=y;e.selectedLayers.push({source:j.source,sourceLayer:j.sourceLayer,filterOp:"==",filterField:"id",filterCompare:y.properties.id})}}else if(y.id&&(y.id+"").length>2&&(o.endsWith(y.id+"","0")&&(w="n"+Math.floor(+y.id/10)),o.endsWith(y.id+"","1")&&(w="w"+Math.floor(+y.id/10)),o.endsWith(y.id+"","4")&&(w="r"+Math.floor(+y.id/10)),w&&o.indexOf(l,w)<0)){l.push(w);var k=y;e.selectedLayers.push({source:k.source,sourceLayer:k.sourceLayer,filterOp:"==",filterField:"$id",filterCompare:y.id})}}}catch(e){d=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(d)throw h}}l=o.compact(o.uniq(l)),e.$store.commit("ideditor/setSelectedIds",{selectedIds:l}),e.highlightSelectedLayers()}else{var x=t.lngLat.lat,C=t.lngLat.lng;e.$emit("observation-marker-move",{lat:x,lng:C})}}))},highlightRouteIds:function(){if(this.$route.query.ids){var e=this.$route.query.ids.split(","),t=!0,r=!1,n=void 0;try{for(var l,c=e[Symbol.iterator]();!(t=(l=c.next()).done);t=!0){var h=l.value;if(o.startsWith(h,"w")){this.selectedLayers.push({source:"composite",sourceLayer:"road",filterOp:"==",filterField:"$id",filterCompare:parseInt(o.trimStart(h,"w")+"1")});var v=!0,f=!1,y=void 0;try{for(var w,_=m[Symbol.iterator]();!(v=(w=_.next()).done);v=!0){var j=w.value;this.selectedLayers.push({source:d[j],sourceLayer:j,filterOp:"==",filterField:"id",filterCompare:"way/"+o.trimStart(h,"w")})}}catch(e){f=!0,y=e}finally{try{v||null==_.return||_.return()}finally{if(f)throw y}}}}}catch(e){r=!0,n=e}finally{try{t||null==c.return||c.return()}finally{if(r)throw n}}this.highlightSelectedLayers()}},center:function(e){this.map&&this.map.panTo(new mapboxgl.LngLat(e.lng,e.lat))},getCenter:function(){if(this.map)return this.map.getBounds().getCenter()},getZoom:function(){if(this.map)return this.map.getZoom()},bounds:function(){return this.map?this.map.getBounds():null},resize:function(e){this.map&&this.map.resize()},getOrganization:function(){var e=Object(n.a)(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,this.$store.dispatch("organization/goFetch",{id:t});case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),addObservation:function(e){var t=this;this.getOrganization(e.properties.organizationId).then(function(r){var n=null,l="";if(o.indexOf(e.properties.tags,"type:report")>-1){l="report";n=c.a.parseHTML('<div class="observationMarker report" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #0000FF;" class="fas fa-exclamation-circle"></i></div>')}else if(o.indexOf(e.properties.tags,"type:trailhead")>-1){l="trailhead";n=c.a.parseHTML('<div class="observationMarker trailhead" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #8B4513;" class="fas fa-sign"></i></div>')}else if(o.indexOf(e.properties.tags,"type:sign")>-1){l="sign";n=c.a.parseHTML('<div class="observationMarker sign" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #25912c;" class="fas fa-map-signs"></i></div>')}else{n=c.a.parseHTML('<div class="observationMarker" style="width: 24px; height: 24px;"><i style="font-size: 24px; color: #ffff00;" class="fas fa-sticky-note"></i></div>')}if(n){var marker=new mapboxgl.Marker(n[0]).setLngLat(e.geometry.coordinates),d='<div style="max-width: 200px;">';if(r&&r.logoImageUrl&&(d+='<img style="height: 36px;" src="'.concat(r.logoImageUrl,'">')),o.has(e,"properties.name")&&e.properties.name?d=d+"<div><strong>"+o.escape(e.properties.name)+"</strong></div>":d+="<div><strong>Observation</strong></div>",o.has(e,"properties.description")&&(d=d+"<div>"+o.escape(e.properties.description)+"</div>"),"trailhead"===l&&(d=d+'<div><a href="https://www.google.com/maps/dir/?api=1&destination='+e.geometry.coordinates[1]+","+e.geometry.coordinates[0]+'" target="_blank">Driving Directions</a></div>'),o.has(e,"properties.tags")&&e.properties.tags){d+='<div style="margin-bottom: 5px;">';var m=!0,h=!1,v=void 0;try{for(var f,y=e.properties.tags[Symbol.iterator]();!(m=(f=y.next()).done);m=!0){var w=f.value;w&&(d=d+'<span class="tag">'+w+"</span>")}}catch(e){h=!0,v=e}finally{try{m||null==y.return||y.return()}finally{if(h)throw v}}d+="</div>"}if(o.has(e,"properties.images")&&e.properties.images){var _=!0,j=!1,k=void 0;try{for(var x,C=e.properties.images[Symbol.iterator]();!(_=(x=C.next()).done);_=!0){var image=x.value;d=d+'<div><img style="cursor: pointer;" style="width: 128px;" data-uri="'+image.url+'" src="'+t.$app_config.traildock_api_base_url+"rest/v2/image/"+image.id+'/resize?width=128&height=128"/></div>'}}catch(e){j=!0,k=e}finally{try{_||null==C.return||C.return()}finally{if(j)throw k}}}t.me&&(t.me.id===e.properties.user.id||t.me.isSuperuser)&&(d+='<div><button class="button is-small is-primary edit">Edit</button><button class="button is-small is-danger destroy">Delete</button></div>'),d+="</div>";var I=c()(c.a.parseHTML(d));I.find("img").on("click",function(e){t.$emit("show-observation-image",c()(e.target).attr("data-uri"))}),I.find("button.destroy").on("click",function(r){t.$emit("delete-observation",e)}),I.find("button.edit").on("click",function(r){t.$emit("edit-observation",e)});var L=(new mapboxgl.Popup).setDOMContent(I[0]);marker.setPopup(L),marker._observation=e,t.observationMarkers.push(marker),marker.addTo(t.map)}})}}},v=(r(378),r(17)),component=Object(v.a)(h,function(){var e=this.$createElement;return(this._self._c||e)("div")},[],!1,null,null,null);t.a=component.exports},378:function(e,t,r){"use strict";var n=r(198);r.n(n).a},379:function(e,t,r){(e.exports=r(52)(!1)).push([e.i,".observationMarker{cursor:pointer}",""])},380:function(e,t,r){var map={"./af":214,"./af.js":214,"./ar":215,"./ar-dz":216,"./ar-dz.js":216,"./ar-kw":217,"./ar-kw.js":217,"./ar-ly":218,"./ar-ly.js":218,"./ar-ma":219,"./ar-ma.js":219,"./ar-sa":220,"./ar-sa.js":220,"./ar-tn":221,"./ar-tn.js":221,"./ar.js":215,"./az":222,"./az.js":222,"./be":223,"./be.js":223,"./bg":224,"./bg.js":224,"./bm":225,"./bm.js":225,"./bn":226,"./bn.js":226,"./bo":227,"./bo.js":227,"./br":228,"./br.js":228,"./bs":229,"./bs.js":229,"./ca":230,"./ca.js":230,"./cs":231,"./cs.js":231,"./cv":232,"./cv.js":232,"./cy":233,"./cy.js":233,"./da":234,"./da.js":234,"./de":235,"./de-at":236,"./de-at.js":236,"./de-ch":237,"./de-ch.js":237,"./de.js":235,"./dv":238,"./dv.js":238,"./el":239,"./el.js":239,"./en-SG":240,"./en-SG.js":240,"./en-au":241,"./en-au.js":241,"./en-ca":242,"./en-ca.js":242,"./en-gb":243,"./en-gb.js":243,"./en-ie":244,"./en-ie.js":244,"./en-il":245,"./en-il.js":245,"./en-nz":246,"./en-nz.js":246,"./eo":247,"./eo.js":247,"./es":248,"./es-do":249,"./es-do.js":249,"./es-us":250,"./es-us.js":250,"./es.js":248,"./et":251,"./et.js":251,"./eu":252,"./eu.js":252,"./fa":253,"./fa.js":253,"./fi":254,"./fi.js":254,"./fo":255,"./fo.js":255,"./fr":256,"./fr-ca":257,"./fr-ca.js":257,"./fr-ch":258,"./fr-ch.js":258,"./fr.js":256,"./fy":259,"./fy.js":259,"./ga":260,"./ga.js":260,"./gd":261,"./gd.js":261,"./gl":262,"./gl.js":262,"./gom-latn":263,"./gom-latn.js":263,"./gu":264,"./gu.js":264,"./he":265,"./he.js":265,"./hi":266,"./hi.js":266,"./hr":267,"./hr.js":267,"./hu":268,"./hu.js":268,"./hy-am":269,"./hy-am.js":269,"./id":270,"./id.js":270,"./is":271,"./is.js":271,"./it":272,"./it-ch":273,"./it-ch.js":273,"./it.js":272,"./ja":274,"./ja.js":274,"./jv":275,"./jv.js":275,"./ka":276,"./ka.js":276,"./kk":277,"./kk.js":277,"./km":278,"./km.js":278,"./kn":279,"./kn.js":279,"./ko":280,"./ko.js":280,"./ku":281,"./ku.js":281,"./ky":282,"./ky.js":282,"./lb":283,"./lb.js":283,"./lo":284,"./lo.js":284,"./lt":285,"./lt.js":285,"./lv":286,"./lv.js":286,"./me":287,"./me.js":287,"./mi":288,"./mi.js":288,"./mk":289,"./mk.js":289,"./ml":290,"./ml.js":290,"./mn":291,"./mn.js":291,"./mr":292,"./mr.js":292,"./ms":293,"./ms-my":294,"./ms-my.js":294,"./ms.js":293,"./mt":295,"./mt.js":295,"./my":296,"./my.js":296,"./nb":297,"./nb.js":297,"./ne":298,"./ne.js":298,"./nl":299,"./nl-be":300,"./nl-be.js":300,"./nl.js":299,"./nn":301,"./nn.js":301,"./pa-in":302,"./pa-in.js":302,"./pl":303,"./pl.js":303,"./pt":304,"./pt-br":305,"./pt-br.js":305,"./pt.js":304,"./ro":306,"./ro.js":306,"./ru":307,"./ru.js":307,"./sd":308,"./sd.js":308,"./se":309,"./se.js":309,"./si":310,"./si.js":310,"./sk":311,"./sk.js":311,"./sl":312,"./sl.js":312,"./sq":313,"./sq.js":313,"./sr":314,"./sr-cyrl":315,"./sr-cyrl.js":315,"./sr.js":314,"./ss":316,"./ss.js":316,"./sv":317,"./sv.js":317,"./sw":318,"./sw.js":318,"./ta":319,"./ta.js":319,"./te":320,"./te.js":320,"./tet":321,"./tet.js":321,"./tg":322,"./tg.js":322,"./th":323,"./th.js":323,"./tl-ph":324,"./tl-ph.js":324,"./tlh":325,"./tlh.js":325,"./tr":326,"./tr.js":326,"./tzl":327,"./tzl.js":327,"./tzm":328,"./tzm-latn":329,"./tzm-latn.js":329,"./tzm.js":328,"./ug-cn":330,"./ug-cn.js":330,"./uk":331,"./uk.js":331,"./ur":332,"./ur.js":332,"./uz":333,"./uz-latn":334,"./uz-latn.js":334,"./uz.js":333,"./vi":335,"./vi.js":335,"./x-pseudo":336,"./x-pseudo.js":336,"./yo":337,"./yo.js":337,"./zh-cn":338,"./zh-cn.js":338,"./zh-hk":339,"./zh-hk.js":339,"./zh-tw":340,"./zh-tw.js":340};function n(e){var t=o(e);return r(t)}function o(e){if(!r.o(map,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return map[e]}n.keys=function(){return Object.keys(map)},n.resolve=o,e.exports=n,n.id=380}}]);